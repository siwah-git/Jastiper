<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <title id="page-title">Manajemen Pengguna - TitipGo Admin</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>

  <style>
    #mainContent {
      background-image: linear-gradient(rgba(255, 255, 255, 0.3),
          rgba(255, 255, 255, 0.3)),
        url("asset/images/background.png");
      /* PASTIKAN PATH INI BENAR */
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      position: relative;
      overflow: hidden;
    }

    /* Pastikan konten di dalam mainContent berada di atas overlay */
    #mainContent>* {
      position: relative;
      z-index: 1;
    }

    /* Style untuk membuat background kartu statistik sedikit transparan */
    .card-bg-transparent {
      background-color: rgba(255,
          255,
          255,
          0.8);
      /* Putih dengan opasitas 80% */
    }

    .bg-white-transparent {
      background-color: rgba(255,
          255,
          255,
          0.85);
      /* Slightly transparent white */
    }

    .bg-blue-600-transparent {
      background-color: rgba(37,
          99,
          235,
          0.85);
      /* Slightly transparent blue */
    }

    .table-bg-transparent {
      background-color: rgba(255,
          255,
          255,
          0.7);
      /* More transparent for table body */
    }

    .header-bg-transparent {
      background-color: rgba(59,
          130,
          246,
          0.85);
      /* Tailwind's blue-500 equivalent with transparency */
    }
  </style>
</head>

<body class="font-sans antialiased">
  <div class="flex min-h-screen">
    <aside
      class="w-67 bg-white-transparent text-gray-800 flex flex-col justify-between shadow-lg fixed top-0 left-0 h-screen z-50">
      <div>
        <nav class="space-y-2 p-4">
          <img src="asset/images/logosiwah.png" alt="Logo" class="w-48 h-20 object-contain mb-4" />

          <a href="admin-dashboard.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
            <i class="fas fa-home mr-3"></i> Dashboard
          </a>
          <a href="admin-katalog.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
            <i class="fas fa-box mr-3"></i> Manajemen Katalog
          </a>
          <a href="admin-pengguna.html"
            class="sidebar-item block py-2 px-4 rounded-md text-white bg-pink-600 font-semibold">
            <i class="fas fa-users mr-3"></i> Manajemen Pengguna
          </a>
          <a href="admin-toko.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
            <i class="fas fa-store mr-3"></i> Manajemen Toko
          </a>
          <a href="admin-pesanan.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
            <i class="fas fa-shopping-cart mr-3"></i> Manajemen Pesanan
          </a>
          <a href="admin-aduan.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
            <i class="fas fa-envelope mr-3"></i> Aduan
          </a>
          <a href="admin-laporan.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
            <i class="fas fa-chart-line mr-3"></i> Laporan
          </a>
          <a href="admin-pendapatan.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
            <i class="fas fa-money-bill-wave mr-3"></i> Pendapatan
          </a>
          <a href="admin-profil.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
            <i class="fas fa-user-circle mr-3"></i> Profil
          </a>

          <a href="admin-tentang.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
            <i class="fas fa-info-circle mr-3"></i> Tentang Kami
          </a>
        </nav>
      </div>
      <footer class="text-sm text-gray-500 text-center p-4 border-t">
        &copy; 2025 TitipGo. All rights reserved.
      </footer>
    </aside>

    <main id="mainContent" class="ml-64 w-full p-6 overflow-y-auto min-h-screen" style="
          background-image: linear-gradient(
              rgba(255, 255, 255, 0.3),
              rgba(255, 255, 255, 0.3)
            ),
            url('asset/images/background.png');
          background-size: cover;
          background-position: center;
          background-repeat: no-repeat;
        ">
      <div class="bg-blue-600 p-4 text-white flex items-center mb-6 rounded-lg">
        <p class="text-lg font-semibold">Manajemen Pengguna</p>
        <div class="flex gap-3 text-right ml-auto">
          <a href="admin-notifikasi.html"
            class="text-pink-100 hover:text-white button-pink-100 transition duration-200 ease-in-out px-4 py-2 rounded-md border border-pink-400 hover:bg-pink-700 text-sm flex items-center"><i
              class="fas fa-bell mr-2"></i> Notifikasi</a>
          <a href="#" id="logoutButton"
            class="text-pink-100 hover:text-white button-pink-100 transition duration-200 ease-in-out px-4 py-2 rounded-md border border-pink-400 hover:bg-pink-700 text-sm flex items-center"><i
              class="fas fa-sign-out-alt mr-2"></i> Logout</a>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6">
        <div class="md:col-span-2 lg:col-span-3">
          <label for="search" class="sr-only">Cari</label>
          <div class="relative">
            <input type="text" id="search" placeholder="Cari..."
              class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:ring-pink-500 focus:border-pink-500 bg-white-transparent" />
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fas fa-search text-gray-400"></i>
            </div>
          </div>
        </div>
        <div class="md:col-span-1 lg:col-span-1">
          <label for="statusFilter" class="sr-only">Status</label>
          <select id="statusFilter"
            class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-pink-200">
            <option value="">Semua Status</option>
            <option value="Aktif">Aktif</option>
            <option value="Nonaktif">Nonaktif</option>
            <option value="Diblokir">Diblokir</option>
          </select>
        </div>
        <div class="md:col-span-1 lg:col-span-1">
          <label for="roleFilter" class="sr-only">Peran</label>
          <select id="roleFilter"
            class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-pink-200">
            <option value="">Semua Peran</option>
            <option value="pembeli">Pembeli</option>
            <option value="jastiper">Jastiper</option>
            <option value="admin">Admin</option>
          </select>
        </div>
      </div>

      <div class="overflow-x-auto rounded-md border border-gray-200">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-blue-600 text-white">
            <tr>
              <th scope="col" class="py-3 px-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                No
              </th>
              <th scope="col" class="py-3 px-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                Nama
              </th>
              <th scope="col" class="py-3 px-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                Email
              </th>
              <th scope="col" class="py-3 px-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                No.Hp
              </th>
              <th scope="col" class="py-3 px-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                Kota
              </th>
              <th scope="col" class="py-3 px-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                Jenis Kelamin
              </th>
              <th scope="col" class="py-3 px-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                Tanggal daftar
              </th>
              <th scope="col" class="py-3 px-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                Tanggal Lahir
              </th>
              <th scope="col" class="py-3 px-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                Peran
              </th>
              <th scope="col" class="py-3 px-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                Status
              </th>
              <th scope="col" class="py-3 px-4 text-center text-xs font-semibold text-white uppercase tracking-wider">
                Aksi
              </th>
            </tr>
          </thead>
          <tbody id="userTableBody" class="divide-y divide-gray-200 table-bg-transparent"></tbody>
        </table>
      </div>

      <div class="mt-6 flex justify-between items-center">
        <div id="paginationInfo" class="text-sm text-gray-700"></div>
        <div id="paginationControls" class="flex"></div>
      </div>
    </main>
  </div>

  <script type="module">
    // Import modul Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      signOut,
    } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-auth.js";
    import {
      getFirestore,
      collection,
      getDocs,
      doc,
      deleteDoc,
      // updateDoc // Jika Anda ingin menggunakan fungsionalitas update status peringatan
    } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore.js";

    // KONFIGURASI FIREBASE ANDA YANG SEBENARNYA!
    const firebaseConfig = {
      apiKey: "AIzaSyCaEVRX88dod-9BWHPCq_RTIIHwus-29rQ", // GANTI DENGAN API KEY ANDA YANG ASLI
      authDomain: "titipgo-28f84.firebaseapp.com", // GANTI DENGAN AUTH DOMAIN ANDA YANG ASLI
      projectId: "titipgo-28f84", // GANTI DENGAN PROJECT ID ANDA YANG ASLI
      storageBucket: "titipgo-28f84.firebasestorage.app",
      messagingSenderId: "816687535591",
      appId: "1:816687535591:web:eaecf2fcc994636a319942",
      // measurementId: "G-CS3V405F3B", // Opsional, jika Anda menggunakan Analytics
    };

    // Inisialisasi Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Dapatkan referensi ke elemen HTML
    const userTableBody = document.getElementById("userTableBody");
    const searchInput = document.getElementById("search");
    const statusFilter = document.getElementById("statusFilter");
    const roleFilter = document.getElementById("roleFilter"); // NEW: Ambil elemen filter peran
    const paginationInfo = document.getElementById("paginationInfo");
    const paginationControls = document.getElementById("paginationControls");
    const logoutButton = document.getElementById("logoutButton");
    const pageTitleEl = document.getElementById("page-title");

    let allUser = [];
    let filteredUser = [];
    const itemsPerPage = 10;
    let currentPage = 1;

    // Helper function untuk memformat timestamp
    function formatTimestamp(timestamp) {
      if (timestamp && typeof timestamp.toDate === "function") {
        const date = timestamp.toDate();
        return date.toLocaleDateString("id-ID", {
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      }
      return "-";
    }

    // Fungsi untuk mengambil pengguna dari Firebase
    async function fetchUser() {
      console.log("Memulai fetchUser()");
      // Update colspan untuk pesan loading/kosong (jumlah kolom di tabel sekarang 11)
      userTableBody.innerHTML = `<tr><td colspan="11" class="py-3 px-4 text-center text-sm text-gray-600">Memuat data pengguna...</td></tr>`;
      if (pageTitleEl)
        pageTitleEl.textContent = "Memuat Pengguna - TitipGo Admin";

      try {
        const usersRef = collection(db, "users");
        console.log("Mengambil snapshot dari koleksi 'users'...");
        const snapshot = await getDocs(usersRef);
        console.log("Snapshot berhasil diambil.");
        console.log("Jumlah dokumen yang ditemukan:", snapshot.docs.length);

        allUser = snapshot.docs.map((doc) => ({
          id: doc.id,
          ...doc.data(),
        }));
        console.log("allUser setelah map:", allUser);

        applyFiltersAndSearch();
        if (pageTitleEl)
          pageTitleEl.textContent = "Manajemen Pengguna - TitipGo Admin";
        console.log("fetchUser() selesai.");
      } catch (error) {
        console.error("Error fetching users: ", error);
        alert("Gagal memuat data pengguna: " + error.message);
        // Update colspan untuk pesan error (jumlah kolom di tabel sekarang 11)
        userTableBody.innerHTML = `<tr><td colspan="11" class="py-3 px-4 text-center text-sm text-red-600">Gagal memuat data pengguna. Silakan coba lagi.</td></tr>`;
        if (pageTitleEl) pageTitleEl.textContent = "Error - TitipGo Admin";
      }
    }

    // Fungsi untuk merender baris tabel
    function renderTable(usersToDisplay) {
      userTableBody.innerHTML = "";
      if (usersToDisplay.length === 0) {
        // Update colspan untuk pesan tidak ada data (jumlah kolom di tabel sekarang 11)
        userTableBody.innerHTML = `<tr><td colspan="11" class="py-3 px-4 text-center text-sm text-gray-600">Tidak ada data pengguna yang cocok dengan kriteria.</td></tr>`;
        paginationInfo.textContent = "Menampilkan 0 dari 0 data";
        paginationControls.innerHTML = "";
        return;
      }

      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      const paginatedUsers = usersToDisplay.slice(startIndex, endIndex);

      paginatedUsers.forEach((user, index) => {
        const row = userTableBody.insertRow();
        const displayIndex = startIndex + index + 1;

        let displayStatus = "Tidak Diketahui";
        let statusClass = "bg-gray-100 text-gray-800";

        if (typeof user.status_akun === "string") {
          const lowerCaseStatus = user.status_akun.toLowerCase();
          if (lowerCaseStatus === "active") {
            displayStatus = "Aktif";
            statusClass = "bg-green-100 text-green-800";
          } else if (lowerCaseStatus === "nonactive") {
            displayStatus = "Nonaktif";
            statusClass = "bg-yellow-100 text-yellow-800";
          } else if (lowerCaseStatus === "diblokir") {
            displayStatus = "Diblokir";
            statusClass = "bg-red-100 text-red-800";
          } else {
            displayStatus =
              lowerCaseStatus.charAt(0).toUpperCase() +
              lowerCaseStatus.slice(1);
          }
        }

        // **PERBAIKAN UTAMA DI SINI: SESUAIKAN NAMA FIELD DENGAN FIRESTORE**
        const formattedTanggalDaftar = formatTimestamp(user.tanggalDaftar); // Menggunakan tanggalDaftar
        const namaPembeli = user.namaLengkap || "-"; // Menggunakan namaLengkap
        const email = user.email || "-";
        const noTelepon = user.noTelepon || "-"; // Menggunakan noTelepon
        const alamat = user.alamat || "-";
        const jenisKelamin = user.jenisKelamin || "-"; // Menggunakan jenisKelamin
        // Jika tanggalLahir adalah Timestamp, format juga seperti tanggalDaftar
        const tanggalLahir =
          typeof user.tanggalLahir === "object" &&
            typeof user.tanggalLahir.toDate === "function"
            ? formatTimestamp(user.tanggalLahir)
            : user.tanggalLahir || "-"; // Menggunakan tanggalLahir
        const role = user.role || "-"; // Sudah sesuai dengan Firestore

        row.innerHTML = `
            <td class="py-3 px-4 text-sm text-gray-700">${displayIndex}</td>
            <td class="py-3 px-4 text-sm text-gray-700">${namaPembeli}</td>
            <td class="py-3 px-4 text-sm text-gray-700">${email}</td>
            <td class="py-3 px-4 text-sm text-gray-700">${noTelepon}</td>
            <td class="py-3 px-4 text-sm text-gray-700">${alamat}</td>
            <td class="py-3 px-4 text-sm text-gray-700">${jenisKelamin}</td>
            <td class="py-3 px-4 text-sm text-gray-700">${formattedTanggalDaftar}</td>
            <td class="py-3 px-4 text-sm text-gray-700">${tanggalLahir}</td>
            <td class="py-3 px-4 text-sm text-gray-700">${role}</td>
            <td class="py-3 px-4 text-sm">
              <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">${displayStatus}</span>
            </td>
            <td class="py-3 px-4 text-sm text-center flex justify-center space-x-2">
              <a href="admin-pengguna-detail.html?id=${user.id}" class="text-blue-600 hover:text-blue-900" title="Lihat"><i class="fas fa-search"></i></a>
              <a href="#" class="text-red-600 hover:text-red-900 delete-user-btn" data-id="${user.id}" title="Hapus"><i class="fas fa-times-circle"></i></a>
              <a href="#" class="text-yellow-600 hover:text-yellow-900 warn-user-btn" data-id="${user.id}" title="Peringatan"><i class="fas fa-exclamation-triangle"></i></a>
            </td>
          `;
      });
      updatePagination(usersToDisplay.length);
    }

    // Fungsi untuk menerapkan pencarian dan filter
    function applyFiltersAndSearch() {
      console.log("Memulai applyFiltersAndSearch()");
      const searchTerm = searchInput.value.toLowerCase();
      const selectedStatus = statusFilter.value;
      const selectedRole = roleFilter.value; // NEW: Ambil nilai filter peran

      filteredUser = allUser.filter((user) => {
        // **PERBAIKI NAMA FIELD UNTUK PENCARIAN DI SINI**
        const matchesSearch =
          (typeof user.namaLengkap === "string" && // Menggunakan namaLengkap
            user.namaLengkap.toLowerCase().includes(searchTerm)) ||
          (typeof user.email === "string" &&
            user.email.toLowerCase().includes(searchTerm)) ||
          (typeof user.noTelepon === "string" && // Menggunakan noTelepon
            user.noTelepon.toLowerCase().includes(searchTerm)) ||
          (typeof user.alamat === "string" &&
            user.alamat.toLowerCase().includes(searchTerm));

        let normalizedUserStatus = "";
        if (typeof user.status_akun === "string") {
          const lowerCaseStatus = user.status_akun.toLowerCase();
          if (lowerCaseStatus === "active") {
            normalizedUserStatus = "Aktif";
          } else if (lowerCaseStatus === "nonactive") {
            normalizedUserStatus = "Nonaktif";
          } else {
            normalizedUserStatus = lowerCaseStatus;
          }
        }

        // NEW: Kondisi filter untuk peran
        const matchesRole =
          selectedRole === "" ||
          (typeof user.role === "string" &&
            user.role.toLowerCase() === selectedRole.toLowerCase());

        const matchesStatus =
          selectedStatus === "" || normalizedUserStatus === selectedStatus;

        // Kombinasikan semua kondisi filter
        return matchesSearch && matchesStatus && matchesRole;
      });

      console.log("filteredUser setelah filter:", filteredUser);
      currentPage = 1;
      renderTable(filteredUser);
      console.log("applyFiltersAndSearch() selesai.");
    }

    // Fungsi untuk memperbarui informasi paginasi dan kontrol
    function updatePagination(totalItems) {
      const totalPages = Math.ceil(totalItems / itemsPerPage);
      paginationInfo.textContent = `Menampilkan ${Math.min(
        (currentPage - 1) * itemsPerPage + 1,
        totalItems
      )}-${Math.min(
        currentPage * itemsPerPage,
        totalItems
      )} dari ${totalItems} data`;

      paginationControls.innerHTML = "";

      const prevButton = document.createElement("button");
      prevButton.textContent = "Previous";
      prevButton.classList.add(
        "px-3",
        "py-1",
        "rounded-md",
        "border",
        "border-gray-300",
        "text-sm",
        "font-medium",
        "hover:bg-gray-200"
      );
      if (currentPage === 1) {
        prevButton.disabled = true;
        prevButton.classList.add("opacity-50", "cursor-not-allowed");
      }
      prevButton.addEventListener("click", () => {
        if (currentPage > 1) {
          currentPage--;
          renderTable(filteredUser);
        }
      });
      paginationControls.appendChild(prevButton);

      for (let i = 1; i <= totalPages; i++) {
        const pageButton = document.createElement("button");
        pageButton.textContent = i;
        pageButton.classList.add(
          "px-3",
          "py-1",
          "rounded-md",
          "border",
          "border-gray-300",
          "text-sm",
          "font-medium",
          "hover:bg-gray-200"
        );
        if (i === currentPage) {
          pageButton.classList.add("bg-pink-600", "text-white");
        }
        pageButton.addEventListener("click", () => {
          currentPage = i;
          renderTable(filteredUser);
        });
        paginationControls.appendChild(pageButton);
      }

      const nextButton = document.createElement("button");
      nextButton.textContent = "Next";
      nextButton.classList.add(
        "px-3",
        "py-1",
        "rounded-md",
        "border",
        "border-gray-300",
        "text-sm",
        "font-medium",
        "hover:bg-gray-200"
      );
      if (currentPage === totalPages || totalPages === 0) {
        nextButton.disabled = true;
        nextButton.classList.add("opacity-50", "cursor-not-allowed");
      }
      nextButton.addEventListener("click", () => {
        if (currentPage < totalPages) {
          currentPage++;
          renderTable(filteredUser);
        }
      });
      paginationControls.appendChild(nextButton);
    }

    // Event listeners untuk pencarian dan filter
    searchInput.addEventListener("keyup", applyFiltersAndSearch);
    statusFilter.addEventListener("change", applyFiltersAndSearch);
    roleFilter.addEventListener("change", applyFiltersAndSearch); // NEW: Event listener untuk filter peran

    // Fungsionalitas Hapus Pengguna
    userTableBody.addEventListener("click", async (event) => {
      if (event.target.closest(".delete-user-btn")) {
        event.preventDefault();
        const userId = event.target.closest(".delete-user-btn").dataset.id;
        if (confirm("Apakah Anda yakin ingin menghapus pengguna ini?")) {
          try {
            await deleteDoc(doc(db, "users", userId));
            alert("Pengguna berhasil dihapus!");
            fetchUser();
          } catch (error) {
            console.error("Error removing user: ", error);
            alert("Gagal menghapus pengguna: " + error.message);
          }
        }
      }
      if (event.target.closest(".warn-user-btn")) {
        event.preventDefault();
        const userId = event.target.closest(".warn-user-btn").dataset.id;
        alert(`Memberikan peringatan kepada pengguna dengan ID: ${userId}`);
        // Jika Anda ingin mengubah status pengguna menjadi "Nonaktif" dari "active"
        // try {
        //   await updateDoc(doc(db, "users", userId), { status_akun: "nonactive" });
        //   alert("Status pengguna diperbarui menjadi Nonaktif!");
        //   fetchUser();
        // } catch (error) {
        //   console.error("Error updating user status:", error);
        //   alert("Gagal memperbarui status pengguna.");
        // }
      }
    });

    // Fungsionalitas Logout
    if (logoutButton) {
      logoutButton.addEventListener("click", async (e) => {
        e.preventDefault();
        try {
          await signOut(auth);
          alert("Anda telah logout!");
          window.location.href = "admin-login.html";
        } catch (error) {
          console.error("Error logging out: ", error);
          alert("Gagal logout: " + error.message);
        }
      });
    }

    // Pengambilan pengguna awal saat halaman dimuat dan cek autentikasi
    document.addEventListener("DOMContentLoaded", () => {
      onAuthStateChanged(auth, (user) => {
        console.log("onAuthStateChanged dipanggil.");
        if (user) {
          console.log("Pengguna terautentikasi:", user.uid);
          fetchUser();

          const currentPath = window.location.pathname;
          const sidebarLinks = document.querySelectorAll(".sidebar-item");

          sidebarLinks.forEach((link) => {
            const linkHref = link.getAttribute("href");
            const currentFilename = currentPath.substring(
              currentPath.lastIndexOf("/") + 1
            );

            let isLinkActive = false;

            if (linkHref === currentFilename) {
              isLinkActive = true;
            } else if (
              currentFilename === "" &&
              linkHref === "admin-dashboard.html"
            ) {
              isLinkActive = true;
            }

            if (isLinkActive) {
              link.classList.remove(
                "text-gray-700",
                "hover:bg-pink-100",
                "hover:text-pink-600"
              );
              link.classList.add(
                "bg-pink-600",
                "text-white",
                "font-semibold"
              );
            } else {
              link.classList.remove(
                "bg-pink-600",
                "text-white",
                "font-semibold"
              );
              link.classList.add(
                "text-gray-700",
                "hover:bg-pink-100",
                "hover:text-pink-600"
              );
            }
          });
        } else {
          console.log(
            "Tidak ada pengguna terautentikasi. Mengarahkan ke login."
          );
          window.location.href = "admin-login.html";
        }
      });
    });
  </script>
</body>

</html>