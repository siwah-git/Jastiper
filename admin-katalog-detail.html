<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manajemen Katalog - TitipGo Admin</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: "Inter", sans-serif;
      overflow: hidden;
      /* Prevent body scroll */
    }

    #mainContent {
      background-image: linear-gradient(rgba(255, 255, 255, 0.3),
          rgba(255, 255, 255, 0.3)),
        url("https://i.ibb.co/G0sTW8C/bg-titipgo.png");
      /* Updated to a reliable CDN URL */
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      position: relative;
      overflow-y: auto;
      /* Allow main content to scroll */
      min-height: 100vh;
    }

    /* Pastikan konten di dalam mainContent berada di atas overlay */
    #mainContent>* {
      position: relative;
      z-index: 1;
    }

    /* Style untuk membuat background kartu statistik sedikit transparan */
    .card-bg-transparent {
      background-color: rgba(255,
          255,
          255,
          0.8);
      /* Putih dengan opasitas 80% */
    }

    /* Added for header transparency */
    .header-bg-transparent {
      background-color: rgba(255, 255, 255, 0.8);
    }

    /* Custom Modal Styling */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .modal-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background-color: #fff;
      padding: 2rem;
      border-radius: 0.75rem;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      text-align: center;
      max-width: 400px;
      width: 90%;
      transform: translateY(-20px);
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
    }

    .modal-overlay.show .modal-content {
      transform: translateY(0);
      opacity: 1;
    }

    .modal-buttons {
      display: flex;
      justify-content: space-around;
      margin-top: 1.5rem;
      gap: 1rem;
    }

    .modal-buttons button {
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s, border-color 0.2s;
    }

    .modal-buttons .btn-cancel {
      background-color: #f0f0f0;
      color: #333;
      border: 1px solid #ccc;
    }

    .modal-buttons .btn-cancel:hover {
      background-color: #e0e0e0;
    }

    .modal-buttons .btn-confirm {
      background-color: #ef4444;
      /* Red color for confirm */
      color: white;
      border: 1px solid #ef4444;
    }

    .modal-buttons .btn-confirm:hover {
      background-color: #dc2626;
    }

    .modal-buttons .btn-confirm.success {
      background-color: #22c55e;
      /* Green for success */
      border-color: #22c55e;
    }

    .modal-buttons .btn-confirm.success:hover {
      background-color: #16a34a;
    }
  </style>
</head>

<body class="flex">
  <aside class="w-67 bg-white text-gray-800 flex flex-col justify-between shadow-lg fixed top-0 left-0 h-screen z-50">
    <div>
      <nav class="space-y-2 p-4">
        <img src="https://i.ibb.co/4J1yg0g/logo-titipgo.png" alt="Logo" class="w-48 h-20 object-contain mb-4" />

        <a href="admin-dashboard.html"
          class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
          <i class="fas fa-home mr-3"></i> Dashboard
        </a>
        <a href="admin-katalog.html"
          class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
          <i class="fas fa-box mr-3"></i> Manajemen Katalog
        </a>
        <a href="admin-pengguna.html"
          class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
          <i class="fas fa-users mr-3"></i> Manajemen Pengguna
        </a>
        <a href="admin-toko.html"
          class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
          <i class="fas fa-store mr-3"></i> Manajemen Toko
        </a>
        <a href="admin-pesanan.html"
          class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
          <i class="fas fa-shopping-cart mr-3"></i> Manajemen Pesanan
        </a>
        <a href="admin-aduan.html"
          class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
          <i class="fas fa-envelope mr-3"></i> Aduan
        </a>
        <a href="admin-laporan.html"
          class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
          <i class="fas fa-chart-line mr-3"></i> Laporan
        </a>
        <a href="admin-pendapatan.html"
          class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
          <i class="fas fa-money-bill-wave mr-3"></i> Pendapatan
        </a>
        <a href="admin-profil.html"
          class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
          <i class="fas fa-user-circle mr-3"></i> Profil
        </a>
        <a href="admin-tentang.html"
          class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
          <i class="fas fa-info-circle mr-3"></i> Tentang Kami
        </a>
      </nav>
    </div>
    <footer class="text-sm text-gray-500 text-center p-4 border-t">
      &copy; 2025 TitipGo. All rights reserved.
    </footer>
  </aside>
  <main id="mainContent" class="ml-64 w-full p-6 overflow-y-auto min-h-screen">
    <div class="bg-blue-600 p-4 text-white flex items-center mb-6 rounded-lg">
      <p class="text-lg font-semibold">Manajemen Katalog</p>
      <div class="flex gap-3 text-right ml-auto">
        <a href="admin-notifikasi.html"
          class="text-pink-100 hover:text-white button-pink-100 transition duration-200 ease-in-out px-4 py-2 rounded-md border border-pink-400 hover:bg-pink-700 text-sm flex items-center"><i
            class="fas fa-bell mr-2"></i> Notifikasi</a>
        <button id="logout-button"
          class="text-pink-100 hover:text-white button-pink-100 transition duration-200 ease-in-out px-4 py-2 rounded-md border border-pink-400 hover:bg-pink-700 text-sm flex items-center">
          <i class="fas fa-sign-out-alt mr-2"></i> Logout
        </button>
      </div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
      <div class="md:col-span-2">
        <label for="search" class="sr-only">Cari barang</label>
        <div class="relative">
          <input type="text" id="search" placeholder="Cari barang..."
            class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:ring-pink-500 focus:border-pink-500" />
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <i class="fas fa-search text-gray-400"></i>
          </div>
        </div>
      </div>
      <div>
        <label for="status" class="sr-only">Status</label>
        <select id="status"
          class="w-full p-2 border border-gray-300 rounded-md focus:ring-pink-500 focus:border-pink-500">
          <option value="">Semua Status</option>
        </select>
      </div>
      <div>
        <label for="toko" class="sr-only">Nama Toko</label>
        <select id="toko"
          class="w-full p-2 border border-gray-300 rounded-md focus:ring-pink-500 focus:border-pink-500">
          <option value="">Semua Toko</option>
        </select>
      </div>
      <div>
        <label for="kategori" class="sr-only">Kategori</label>
        <select id="kategori"
          class="w-full p-2 border border-gray-300 rounded-md focus:ring-pink-500 focus:border-pink-500">
          <option value="">Semua Kategori</option>
        </select>
      </div>
    </div>

    <div class="card-bg-transparent overflow-x-auto rounded-md border border-gray-200">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-blue-600 text-white">
          <tr>
            <th scope="col" class="py-3 px-4 text-left text-xs font-semibold uppercase tracking-wider">
              No
            </th>
            <th scope="col" class="py-3 px-4 text-left text-xs font-semibold uppercase tracking-wider">
              Foto
            </th>
            <th scope="col" class="py-3 px-4 text-left text-xs font-semibold uppercase tracking-wider">
              Nama Barang
            </th>
            <th scope="col" class="py-3 px-4 text-left text-xs font-semibold uppercase tracking-wider">
              Kategori
            </th>
            <th scope="col" class="py-3 px-4 text-left text-xs font-semibold uppercase tracking-wider">
              Toko
            </th>
            <th scope="col" class="py-3 px-4 text-left text-xs font-semibold uppercase tracking-wider">
              Harga
            </th>
            <th scope="col" class="py-3 px-4 text-left text-xs font-semibold uppercase tracking-wider">
              Negara
            </th>
            <th scope="col" class="py-3 px-4 text-left text-xs font-semibold uppercase tracking-wider">
              Fee
            </th>
            <th scope="col" class="py-3 px-4 text-left text-xs font-semibold uppercase tracking-wider">
              Status
            </th>
            <th scope="col" class="py-3 px-4 text-center text-xs font-semibold uppercase tracking-wider">
              Aksi
            </th>
          </tr>
        </thead>
        <tbody id="catalogTableBody" class="divide-y divide-gray-200">
          <tr>
            <td colspan="10" class="py-4 px-4 text-center text-gray-500">
              Memuat data katalog...
            </td>
          </tr>
        </tbody>
      </table>
      <div id="noDataMessage" class="hidden py-4 px-4 text-center text-gray-500">
        Tidak ada data katalog yang ditemukan.
      </div>
    </div>

    <div class="mt-6 flex justify-between items-center">
      <div id="paginationInfo" class="text-sm text-gray-700"></div>
      <div id="paginationButtons" class="flex"></div>
    </div>
  </main>

  <!-- Logout Confirmation Modal -->
  <div id="logout-modal" class="modal-overlay">
    <div class="modal-content">
      <h3 class="text-xl font-semibold mb-4">Konfirmasi Logout</h3>
      <p class="text-gray-700">
        Apakah Anda yakin ingin keluar dari akun ini?
      </p>
      <div class="modal-buttons">
        <button id="cancel-logout" class="btn-cancel">Batal</button>
        <button id="confirm-logout" class="btn-confirm">Logout</button>
      </div>
    </div>
  </div>

  <!-- Custom Confirmation/Alert Modal -->
  <div id="custom-confirm-modal" class="modal-overlay">
    <div class="modal-content">
      <h3 class="text-xl font-semibold mb-4" id="custom-confirm-title">Peringatan!</h3>
      <p class="text-gray-700 mb-4" id="custom-confirm-message"></p>
      <div class="modal-buttons">
        <button id="custom-cancel-btn" class="btn-cancel hidden">Batal</button>
        <button id="custom-confirm-btn" class="btn-confirm">OK</button>
      </div>
    </div>
  </div>

  <script type="module">
    // Import Firebase functions from firebase-config.js
    import {
      auth,
      db,
      signOut,
      onAuthStateChanged,
      collection,
      query,
      where,
      getDocs,
      doc,
      deleteDoc
    } from './firebase-config.js'; // Ensure this path is correct

    let currentAdminId = null;

    // Custom Confirmation/Alert Modal elements
    const customConfirmModal = document.getElementById('custom-confirm-modal');
    const customConfirmTitle = document.getElementById('custom-confirm-title');
    const customConfirmMessage = document.getElementById('custom-confirm-message');
    const customCancelBtn = document.getElementById('custom-cancel-btn');
    const customConfirmBtn = document.getElementById('custom-confirm-btn');
    let customConfirmCallback = null;

    // Function to show custom confirmation/alert modal
    function showCustomConfirm(message, callback, isConfirmation = false) {
      customConfirmMessage.textContent = message;
      customConfirmCallback = callback;
      customConfirmTitle.textContent = isConfirmation ? "Konfirmasi" : "Peringatan!";
      if (isConfirmation) {
        customCancelBtn.classList.remove('hidden');
      } else {
        customCancelBtn.classList.add('hidden');
      }
      customConfirmBtn.textContent = isConfirmation ? "Ya" : "OK"; // Change text based on type
      customConfirmBtn.classList.remove('success'); // Reset button style
      customConfirmModal.classList.add('show');
    }

    customCancelBtn.addEventListener('click', () => {
      customConfirmModal.classList.remove('show');
      customConfirmCallback = null; // Clear callback if cancelled
    });

    customConfirmBtn.addEventListener('click', () => {
      customConfirmModal.classList.remove('show');
      if (customConfirmCallback) {
        customConfirmCallback();
      }
      customConfirmCallback = null; // Clear callback after execution
    });

    // DOM Elements
    const catalogTableBody = document.getElementById("catalogTableBody");
    const noDataMessage = document.getElementById("noDataMessage");
    const searchInput = document.getElementById("search");
    const statusFilter = document.getElementById("status");
    const tokoFilter = document.getElementById("toko");
    const kategoriFilter = document.getElementById("kategori");
    const logoutButton = document.getElementById("logout-button");
    const logoutModal = document.getElementById("logout-modal");
    const cancelLogoutButton = document.getElementById("cancel-logout");
    const confirmLogoutButton = document.getElementById("confirm-logout");

    let allProducts = [];
    const itemsPerPage = 10;
    let currentPage = 1;

    // Fungsi untuk memformat harga ke IDR
    function formatRupiah(amount) {
      return new Intl.NumberFormat("id-ID", {
        style: "currency",
        currency: "IDR",
        minimumFractionDigits: 0,
      }).format(amount);
    }

    async function fetchCatalogData() {
      catalogTableBody.innerHTML = `<tr><td colspan="10" class="py-4 px-4 text-center text-gray-500">Memuat data katalog...</td></tr>`;
      noDataMessage.classList.add("hidden");
      try {
        if (typeof db === "undefined" || !db) {
          console.error(
            "Firebase Firestore tidak diinisialisasi. Pastikan SDK Firebase dimuat dengan benar."
          );
          catalogTableBody.innerHTML = `<tr><td colspan="10" class="py-4 px-4 text-center text-red-500">Error: Firebase tidak terinisialisasi.</td></tr>`;
          return;
        }

        const productsCol = collection(db, "produk"); // Use modular collection
        const tokoCol = collection(db, "toko"); // Use modular collection

        const productSnapshot = await getDocs(productsCol); // Use modular getDocs
        const tokoSnapshot = await getDocs(tokoCol); // Use modular getDocs

        const tokoMap = new Map();
        tokoSnapshot.forEach((doc) => {
          tokoMap.set(doc.id, doc.data().nama_toko); // Use nama_toko as per daftar-toko-html
        });

        allProducts = [];
        const uniqueTokos = new Set();
        const uniqueKategori = new Set();
        const uniqueStatus = new Set();

        productSnapshot.forEach((doc) => {
          const data = doc.data();
          const tokoId = data.tokoId;
          const namaToko = tokoMap.get(tokoId) || "Toko Tidak Ditemukan";

          allProducts.push({ id: doc.id, namaToko: namaToko, ...data });

          if (namaToko) {
            uniqueTokos.add(namaToko);
          }
          if (data.kategori) {
            uniqueKategori.add(data.kategori);
          }
          if (data.keterangan) { // Use 'keterangan' as per tambah-produk-baru-html
            uniqueStatus.add(data.keterangan);
          }
        });

        populateTokoFilter(Array.from(uniqueTokos));
        populateKategoriFilter(Array.from(uniqueKategori));
        populateStatusFilter(Array.from(uniqueStatus));
        renderTable();
      } catch (error) {
        console.error("Error fetching catalog data: ", error);
        catalogTableBody.innerHTML = `<tr><td colspan="10" class="py-4 px-4 text-center text-red-500">Gagal memuat data. Error: ${error.message}</td></tr>`;
      }
    }

    function populateTokoFilter(tokos) {
      tokoFilter.innerHTML = '<option value="">Semua Toko</option>';
      tokos.sort().forEach((toko) => {
        const option = document.createElement("option");
        option.value = toko;
        option.textContent = toko;
        tokoFilter.appendChild(option);
      });
    }

    function populateKategoriFilter(kategoriArray) {
      kategoriFilter.innerHTML = '<option value="">Semua Kategori</option>';
      kategoriArray.sort().forEach((kategori) => {
        const option = document.createElement("option");
        option.value = kategori;
        option.textContent = kategori;
        kategoriFilter.appendChild(option);
      });
    }

    function populateStatusFilter(statusArray) {
      statusFilter.innerHTML = '<option value="">Semua Status</option>';
      statusArray.sort().forEach((status) => {
        const option = document.createElement("option");
        option.value = status;
        option.textContent = status;
        statusFilter.appendChild(option);
      });
    }

    function renderTable() {
      catalogTableBody.innerHTML = "";
      const filteredProducts = applyFilters(allProducts);

      if (filteredProducts.length === 0) {
        noDataMessage.classList.remove("hidden");
        document.getElementById("paginationInfo").textContent = "";
        document.getElementById("paginationButtons").innerHTML = "";
        return;
      } else {
        noDataMessage.classList.add("hidden");
      }

      const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = Math.min(
        startIndex + itemsPerPage,
        filteredProducts.length
      );
      const paginatedProducts = filteredProducts.slice(
        startIndex,
        endIndex
      );

      paginatedProducts.forEach((product, index) => {
        const row = document.createElement("tr");
        row.classList.add("bg-white", "bg-opacity-80");
        const displayIndex = startIndex + index + 1;

        let statusText = product.keterangan || "Tidak Diketahui"; // Use 'keterangan'
        let statusClass = "bg-gray-100 text-gray-800";
        if (statusText === "READY ID") {
          statusClass = "bg-green-100 text-green-800";
        } else if (statusText === "PRE-ORDER") {
          statusClass = "bg-yellow-100 text-yellow-800";
        } else if (statusText === "KOSONG") {
          statusClass = "bg-red-100 text-red-800";
        }

        row.innerHTML = `
                                <td class="py-3 px-4 text-sm text-gray-700">${displayIndex}</td>
                                <td class="py-3 px-4">
                                    <img src="${product.imageUrl ||
          "https://via.placeholder.com/40x40"
          }" alt="Foto ${product.namaBarang
          }" class="w-10 h-10 rounded-md object-cover">
                                </td>
                                <td class="py-3 px-4 text-sm text-gray-700">${product.namaBarang || "-"
          }</td>
                                <td class="py-3 px-4 text-sm text-gray-700">${product.kategori || "-"
          }</td>
                                <td class="py-3 px-4 text-sm text-gray-700">${product.namaToko || "-"
          }</td>
                                <td class="py-3 px-4 text-sm text-gray-700">${formatRupiah(
            product.harga || 0
          )}</td>
                                <td class="py-3 px-4 text-sm text-gray-700">${product.negara || "-"
          }</td>
                                <td class="py-3 px-4 text-sm text-gray-700">${formatRupiah(
            product.fee || 0
          )}</td>
                                <td class="py-3 px-4 text-sm">
                                    <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">${statusText}</span>
                                </td>
                                <td class="py-3 px-4 text-sm text-center flex justify-center space-x-2">
                                    <a href="admin-katalog-detail.html?id=${product.id
          }" class="text-blue-600 hover:text-blue-900" title="Lihat"><i class="fas fa-eye"></i></a>
                                    <a href="edit-product.html?id=${product.id}" class="text-yellow-600 hover:text-yellow-900" title="Edit"><i class="fas fa-edit"></i></a>
                                    <button type="button" class="text-red-600 hover:text-red-900 delete-button" data-id="${product.id
          }" title="Hapus"><i class="fas fa-trash"></i></button>
                                </td>
                            `;
        catalogTableBody.appendChild(row);
      });

      document.querySelectorAll(".delete-button").forEach((button) => {
        button.addEventListener("click", function (event) {
          event.preventDefault();
          const productId = this.dataset.id;
          showCustomConfirm("Apakah Anda yakin ingin menghapus katalog ini?", () => {
            deleteProduct(productId);
          }, true);
        });
      });

      updatePaginationControls(filteredProducts.length, totalPages);
    }

    async function deleteProduct(productId) {
      try {
        await deleteDoc(doc(db, "produk", productId)); // Use modular deleteDoc
        showCustomConfirm("Katalog berhasil dihapus!", () => {
          fetchCatalogData();
        }, false);
      } catch (error) {
        console.error("Error removing document: ", error);
        showCustomConfirm("Gagal menghapus katalog: " + error.message, () => { });
      }
    }

    function applyFilters(products) {
      let filtered = [...products];

      const searchTerm = searchInput.value.toLowerCase();
      const selectedStatus = statusFilter.value;
      const selectedToko = tokoFilter.value;
      const selectedKategori = kategoriFilter.value;

      if (searchTerm) {
        filtered = filtered.filter((product) =>
          product.namaBarang.toLowerCase().includes(searchTerm)
        );
      }

      if (selectedStatus) {
        filtered = filtered.filter(
          (product) => product.keterangan === selectedStatus // Use 'keterangan' for filtering
        );
      }

      if (selectedToko) {
        filtered = filtered.filter(
          (product) => product.namaToko === selectedToko
        );
      }

      if (selectedKategori) {
        filtered = filtered.filter(
          (product) => product.kategori === selectedKategori
        );
      }
      return filtered;
    }

    function updatePaginationControls(totalItems, totalPages) {
      const paginationInfo = document.getElementById("paginationInfo");
      const paginationButtons =
        document.getElementById("paginationButtons");

      const startIndex = (currentPage - 1) * itemsPerPage + 1;
      const endIndex = Math.min(startIndex + itemsPerPage - 1, totalItems);
      paginationInfo.textContent = `Menampilkan ${startIndex} sampai ${endIndex} dari ${totalItems} data`;

      paginationButtons.innerHTML = "";

      const prevButton = document.createElement("button");
      prevButton.className = `px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-l-md hover:bg-gray-50 ${currentPage === 1 ? "opacity-50 cursor-not-allowed" : ""
        }`;
      prevButton.textContent = "Previous";
      prevButton.disabled = currentPage === 1;
      prevButton.addEventListener("click", () => {
        if (currentPage > 1) {
          currentPage--;
          renderTable();
        }
      });
      paginationButtons.appendChild(prevButton);

      for (let i = 1; i <= totalPages; i++) {
        const pageButton = document.createElement("button");
        let buttonClass = `px-4 py-2 text-sm font-medium ${currentPage === i
          ? "text-pink-600 bg-pink-100"
          : "text-gray-700 bg-white"
          } border border-gray-300 hover:bg-gray-50`;

        if (i === 1 && totalPages === 1) {
          buttonClass += " rounded-l-md rounded-r-md";
        } else if (i === 1) {
          buttonClass += " -ml-px";
        } else if (i === totalPages) {
          buttonClass += " -ml-px rounded-r-md";
        } else {
          buttonClass += " -ml-px";
        }

        pageButton.className = buttonClass;
        pageButton.textContent = i;
        pageButton.addEventListener("click", () => {
          currentPage = i;
          renderTable();
        });
        paginationButtons.appendChild(pageButton);
      }

      const nextButton = document.createElement("button");
      nextButton.className = `px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-r-md hover:bg-gray-50 -ml-px ${currentPage === totalPages ? "opacity-50 cursor-not-allowed" : ""
        }`;
      nextButton.textContent = "Next";
      nextButton.disabled = currentPage === totalPages;
      nextButton.addEventListener("click", () => {
        if (currentPage < totalPages) {
          currentPage++;
          renderTable();
        }
      });
      paginationButtons.appendChild(nextButton);
    }

    // Event Listener untuk pencarian dan filter
    searchInput.addEventListener("keyup", () => {
      currentPage = 1;
      renderTable();
    });
    statusFilter.addEventListener("change", () => {
      currentPage = 1;
      renderTable();
    });
    tokoFilter.addEventListener("change", () => {
      currentPage = 1;
      renderTable();
    });
    kategoriFilter.addEventListener("change", () => {
      currentPage = 1;
      renderTable();
    });

    // Logout functionality
    logoutButton.addEventListener("click", () => {
      logoutModal.classList.add("show");
    });

    cancelLogoutButton.addEventListener("click", () => {
      logoutModal.classList.remove("show");
    });

    confirmLogoutButton.addEventListener("click", async () => {
      try {
        await signOut(auth);
        console.log("Berhasil logout dari Firebase.");
        showCustomConfirm("Anda telah logout.", () => {
          window.location.href = "halaman_login_anda.html"; // Redirect to your login page
        }, false);
        logoutModal.classList.remove("show");
      } catch (error) {
        console.error("Error saat logout:", error);
        showCustomConfirm("Terjadi kesalahan saat logout. Silakan coba lagi: " + error.message, () => { });
      }
    });

    // Initial load and Firebase Auth State management
    document.addEventListener("DOMContentLoaded", function () {
      // Logika tautan sidebar aktif
      const currentPath = window.location.pathname.split("/").pop();
      const sidebarLinks = document.querySelectorAll(".sidebar-item");

      sidebarLinks.forEach((link) => {
        const linkHref = link.getAttribute("href");
        if (linkHref === currentPath) {
          link.classList.remove(
            "text-gray-700",
            "hover:bg-pink-100",
            "hover:text-pink-600"
          );
          link.classList.add("bg-pink-600", "text-white", "font-semibold");
        } else {
          link.classList.remove("bg-pink-600", "text-white", "font-semibold");
          link.classList.add(
            "text-gray-700",
            "hover:bg-pink-100",
            "hover:text-pink-600"
          );
        }
      });

      onAuthStateChanged(auth, (user) => {
        if (user) {
          currentAdminId = user.uid;
          console.log("Admin ID:", currentAdminId);
          fetchCatalogData(); // Panggil fungsi pengambilan data setelah admin terautentikasi
        } else {
          console.warn("User tidak terautentikasi. Mengarahkan ke halaman login.");
          showCustomConfirm("Anda belum login sebagai Admin. Silakan login terlebih dahulu.", () => {
            window.location.href = "halaman_login_anda.html"; // Replace with your actual admin login page
          });
        }
      });
    });
  </script>
</body>

</html>