<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Manajemen Katalog - TitipGo Admin</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      #mainContent {
        background-image: linear-gradient(
            rgba(255, 255, 255, 0.3),
            rgba(255, 255, 255, 0.3)
          ),
          url("asset/images/background.png"); /* PASTIKAN PATH INI BENAR */
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        position: relative;
        overflow: hidden;
      }

      /* Optional: Overlay tambahan jika diperlukan */
      /* #mainContent::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.1); 
        z-index: 0;
        border-radius: inherit;
      } */

      /* Pastikan konten di dalam mainContent berada di atas overlay */
      #mainContent > * {
        position: relative;
        z-index: 1;
      }

      /* Style untuk membuat background kartu statistik sedikit transparan */
      .card-bg-transparent {
        background-color: rgba(
          255,
          255,
          255,
          0.8
        ); /* Putih dengan opasitas 80% */
      }
      /* Added for header transparency */
      .header-bg-transparent {
        background-color: rgba(255, 255, 255, 0.8);
      }
    </style>
  </head>
  <body class="flex">
    <aside
      class="w-67 bg-white text-gray-800 flex flex-col justify-between shadow-lg fixed top-0 left-0 h-screen z-50"
    >
      <div>
        <nav class="space-y-2 p-4">
          <img
            src="asset/images/logosiwah.png"
            alt="Logo"
            class="w-48 h-20 object-contain mb-4"
          />

          <a
            href="admin-dashboard.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition"
          >
            <i class="fas fa-home mr-3"></i> Dashboard
          </a>
          <a
            href="admin-katalog.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition"
          >
            <i class="fas fa-box mr-3"></i> Manajemen Katalog
          </a>
          <a
            href="admin-pengguna.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition"
          >
            <i class="fas fa-users mr-3"></i> Manajemen Pengguna
          </a>
          <a
            href="admin-toko.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition"
          >
            <i class="fas fa-store mr-3"></i> Manajemen Toko
          </a>
          <a
            href="admin-pesanan.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition"
          >
            <i class="fas fa-shopping-cart mr-3"></i> Manajemen Pesanan
          </a>
          <a
            href="admin-aduan.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition"
          >
            <i class="fas fa-envelope mr-3"></i> Aduan
          </a>
          <a
            href="admin-laporan.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition"
          >
            <i class="fas fa-chart-line mr-3"></i> Laporan
          </a>
          <a
            href="admin-pendapatan.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition"
          >
            <i class="fas fa-money-bill-wave mr-3"></i> Pendapatan
          </a>
          <a
            href="admin-profil.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition"
          >
            <i class="fas fa-user-circle mr-3"></i> Profil
          </a>
          <a
            href="admin-tentang.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition"
          >
            <i class="fas fa-user-circle mr-3"></i> Tentang Kami
          </a>
        </nav>
      </div>
      <footer class="text-sm text-gray-500 text-center p-4 border-t">
        &copy; 2025 TitipGo. All rights reserved.
      </footer>
    </aside>
    <main
      id="mainContent"
      class="ml-64 w-full p-6 overflow-y-auto min-h-screen"
      style="
        background-image: linear-gradient(
            rgba(255, 255, 255, 0.3),
            rgba(255, 255, 255, 0.3)
          ),
          url('asset/images/background.png');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
      "
    >
      <div class="bg-blue-600 p-4 text-white flex items-center mb-6 rounded-lg">
        <p class="text-lg font-semibold" id="productDetailTitle" >Detail Produk: Memuat....</p>
        <div class="flex gap-3 text-right ml-auto">
          </div>
          <div class="text-right flex gap-3">
            <!-- Tombol aksi produk, misalnya Edit/Hapus -->
            <button
              id="edit-product-button"
              class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm transition duration-200 ease-in-out flex items-center text-sm"
            >
              <i class="fas fa-edit mr-2"></i> Edit Produk
            </button>
            <button
              id="delete-product-button"
              class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm transition duration-200 ease-in-out flex items-center text-sm"
            >
              <i class="fas fa-trash-alt mr-2"></i> Hapus Produk
            </button>
            <a
              href="#"
              id="logoutButton"
              class="text-orange-100 hover:text-white transition duration-200 ease-in-out px-4 py-2 rounded-md border border-orange-400 hover:bg-orange-700 text-sm flex items-center"
              ><i class="fas fa-sign-out-alt mr-2"></i> Logout</a
            >
          </div>
        </div>

        <!-- Breadcrumb Dinamis -->
        <nav class="text-sm text-gray-600 mb-6">
          <ol class="list-none p-0 inline-flex">
            <li class="flex items-center">
              <a
                href="admin-dashboard.html"
                class="text-blue-600 hover:text-blue-800"
                >Dashboard</a
              >
              <i class="fas fa-chevron-right mx-2 text-xs"></i>
            </li>
            <li class="flex items-center">
              <a
                href="admin-katalog.html"
                class="text-blue-600 hover:text-blue-800"
                >Manajemen Katalog</a
              >
              <i class="fas fa-chevron-right mx-2 text-xs"></i>
            </li>
            <li
              id="breadcrumbProductName"
              class="flex items-center text-gray-500"
            >
              Memuat...
            </li>
          </ol>
        </nav>

        <!-- Konten Detail Produk (akan diisi oleh JavaScript) -->
        <div id="productDetailContent" class="flex flex-col space-y-6">
          <!-- Initial loading state -->
          <div class="bg-white p-6 rounded-lg shadow-md text-center">
            <p class="text-gray-600 text-lg">Memuat data produk...</p>
          </div>
        </div>
      </div>
    </main>

    <!-- Firebase SDKs (Modular SDK v9.6.0) -->
    <script type="module">
      // Import fungsi-fungsi Firebase dari CDN (Modular SDK v9.6.0)
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js";
      import { getAuth } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-auth.js";
      import {
        getFirestore,
        doc,
        getDoc,
        deleteDoc,
        collection,
      } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore.js";
      import {
        getStorage,
        ref,
        getDownloadURL,
      } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-storage.js";

      // KONFIGURASI FIREBASE ANDA YANG SEBENARNYA!
      const firebaseConfig = {
        apiKey: "AIzaSyCaEVRX88dod-9BWHPCq_RTIIHwus-29rQ",
        authDomain: "titipgo-28f84.firebaseapp.com",
        projectId: "titipgo-28f84",
        storageBucket: "titipgo-28f84.firebasestorage.app",
        messagingSenderId: "816687535591",
        appId: "1:816687535591:web:eaecf2fcc994636a319942",
        // measurementId: "G-CS3V405F3B", // Opsional, jika Anda menggunakan Analytics
      };

      // Inisialisasi Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);
      const storage = getStorage(app);

      // --- Fungsi untuk Mendapatkan Parameter URL (Product ID) ---
      function getUrlParameter(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)");
        var results = regex.exec(location.search);
        return results === null
          ? ""
          : decodeURIComponent(results[1].replace(/\+/g, " "));
      }

      // --- Fungsi untuk Memuat Detail Produk ---
      async function loadProductDetail() {
        const productId = getUrlParameter("id");
        const productDetailContent = document.getElementById(
          "productDetailContent"
        );
        const productDetailTitle =
          document.getElementById("productDetailTitle");
        const breadcrumbProductName = document.getElementById(
          "breadcrumbProductName"
        );
        const pageTitleEl = document.getElementById("page-title");
        const editProductButton = document.getElementById(
          "edit-product-button"
        );
        const deleteProductButton = document.getElementById(
          "delete-product-button"
        );

        // Set initial loading state for the content area
        productDetailContent.innerHTML = `
          <div class="bg-white p-6 rounded-lg shadow-md text-center">
            <p class="text-gray-600 text-lg">Memuat data produk...</p>
          </div>
        `;
      }
      pageTitleEl.textContent = `Memuat Produk - TitipGo Admin`;
      if (productDetailTitle)
        productDetailTitle.textContent = `Memuat Detail Produk...`;
      if (breadcrumbProductName)
        breadcrumbProductName.textContent = `Memuat...`;
      if (editProductButton) editProductButton.classList.add("hidden");
      if (deleteProductButton) deleteProductButton.classList.add("hidden");

      if (!productId) {
        productDetailContent.innerHTML = `
            <div class="bg-white p-6 rounded-lg shadow-md mb-6 text-center">
              <p class="text-red-500 text-xl font-semibold">ID Produk tidak ditemukan di URL.</p>
              <p class="text-gray-600 mt-2">Pastikan Anda mengakses halaman ini dengan ID produk yang valid.</p>
              <div class="mt-4">
                <a href="admin-katalog.html" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                  <i class="fas fa-arrow-left mr-2"></i> Kembali ke Daftar Katalog
                </a>
              </div>
            </div>
          `;
        pageTitleEl.textContent = `Error - TitipGo Admin`;
        if (productDetailTitle)
          productDetailTitle.textContent = `Produk Tidak Ditemukan`;
        if (breadcrumbProductName)
          breadcrumbProductName.textContent = `Tidak Ditemukan`;
        return;
      }

      try {
        // Ambil data produk dari koleksi "produk"
        const productDocRef = doc(db, "produk", productId);
        const productDoc = await getDoc(productDocRef);

        if (productDoc.exists()) {
          const productData = productDoc.data();

          // Ambil informasi jastiper/toko
          let jastiperInfo = {
            name: "Tidak Diketahui",
            id: "",
            location: "Tidak Diketahui",
            email: "#",
            phone: "#",
            profileUrl: "#",
            photoUrl:
              "https://via.placeholder.com/80x80/20B2AA/FFFFFF?text=Jastiper",
          };

          if (productData.jastiperId) {
            const jastiperDocRef = doc(db, "users", productData.jastiperId); // Asumsi jastiper ada di koleksi 'users'
            const jastiperDoc = await getDoc(jastiperDocRef);
            if (jastiperDoc.exists()) {
              const jastiperData = jastiperDoc.data();
              jastiperInfo = {
                name: jastiperData.fullName || "Nama Jastiper",
                id: productData.jastiperId,
                location: jastiperData.originCountry || "Lokasi", // Asumsi originCountry adalah lokasi
                email: jastiperData.email || "#",
                phone: jastiperData.phoneNumber || "#",
                profileUrl: `admin-pengguna-detail.html?id=${productData.jastiperId}`,
                photoUrl:
                  jastiperData.profilePictureUrl ||
                  "https://via.placeholder.com/80x80/20B2AA/FFFFFF?text=Jastiper",
              };
              // Fetch jastiper photo from storage if it's a gs:// path
              if (jastiperInfo.photoUrl.startsWith("gs://")) {
                try {
                  const photoRef = ref(storage, jastiperInfo.photoUrl);
                  jastiperInfo.photoUrl = await getDownloadURL(photoRef);
                } catch (error) {
                  console.warn(
                    "Error fetching jastiper photo from storage:",
                    error
                  );
                  jastiperInfo.photoUrl =
                    "https://via.placeholder.com/80x80/CCCCCC/FFFFFF?text=Error";
                }
              }
            }
          }

          // Dapatkan URL gambar utama dari Firebase Storage jika disimpan di sana
          let mainImageUrl =
            productData.mainImage ||
            "https://via.placeholder.com/400x400/FF69B4/FFFFFF?text=Tidak+Ada+Gambar";
          if (mainImageUrl.startsWith("gs://")) {
            try {
              const imageRef = ref(storage, mainImageUrl);
              mainImageUrl = await getDownloadURL(imageRef);
            } catch (storageError) {
              console.warn(
                "Error fetching main image from storage:",
                storageError
              );
              mainImageUrl =
                "https://via.placeholder.com/400x400/FF69B4/FFFFFF?text=Gagal+Muat+Gambar";
            }
          }

          // Dapatkan URL galeri gambar
          let galleryImagesHtml = "";
          if (
            productData.galleryImages &&
            productData.galleryImages.length > 0
          ) {
            for (const imgPath of productData.galleryImages) {
              let downloadUrl = imgPath;
              if (imgPath.startsWith("gs://")) {
                try {
                  const imageRef = ref(storage, imgPath);
                  downloadUrl = await getDownloadURL(imageRef);
                } catch (storageError) {
                  console.warn(
                    "Error fetching gallery image from storage:",
                    storageError
                  );
                  downloadUrl =
                    "https://via.placeholder.com/100x100/CCCCCC/000000?text=Error";
                }
              }
              galleryImagesHtml += `
                  <img
                    src="${downloadUrl}"
                    alt="Gambar Produk"
                    class="w-full h-32 object-cover rounded-md shadow-sm border border-gray-200 hover:border-blue-400 cursor-pointer transition duration-200"
                    onclick="window.open('${downloadUrl}', '_blank');"
                  />
                `;
            }
          } else {
            galleryImagesHtml = `
                <p class="text-gray-500 text-sm italic col-span-full">Tidak ada gambar galeri.</p>
              `;
          }

          // Render konten produk
          productDetailContent.innerHTML = `
              <div class="bg-white p-6 rounded-lg shadow-md">
                <div class="flex flex-col md:flex-row items-start md:items-center mb-6 border-b pb-4">
                  <img
                    src="${mainImageUrl}"
                    alt="${productData.productName || "Nama Produk"}"
                    class="w-full md:w-64 h-auto md:h-64 object-cover rounded-lg shadow-lg mb-4 md:mb-0 md:mr-6"
                  />
                  <div>
                    <span
                      class="text-sm font-semibold ${
                        productData.stock > 0
                          ? "text-pink-600 bg-pink-100"
                          : "text-red-600 bg-red-100"
                      } px-3 py-1 rounded-full"
                    >${productData.stock > 0 ? "Tersedia" : "Habis"}</span
                    >
                    <h2 class="text-3xl font-bold text-gray-800 mt-2 mb-2">
                      ${productData.productName || "Nama Produk"}
                    </h2>
                    <p class="text-green-600 text-3xl font-bold mb-4">Rp ${(
                      productData.price || 0
                    ).toLocaleString("id-ID")}</p>
                    <div class="flex items-center text-gray-600 text-sm mb-2">
                      <i class="fas fa-star text-yellow-500 mr-1"></i> ${
                        productData.rating || "N/A"
                      } (${productData.reviewsCount || 0} Ulasan)
                    </div>
                    <p class="text-gray-700 text-md leading-relaxed">
                      ${
                        productData.shortDescription ||
                        "Tidak ada deskripsi singkat."
                      }
                    </p>
                  </div>
                </div>

                <div class="mb-6">
                  <h3
                    class="text-xl font-semibold text-gray-800 mb-3 flex items-center"
                  >
                    <i class="fas fa-info-circle text-blue-500 mr-2"></i> Detail Produk
                  </h3>
                  <div
                    class="grid grid-cols-1 sm:grid-cols-2 gap-y-2 gap-x-4 text-gray-700 text-sm"
                  >
                    <p><strong>SKU:</strong> ${productData.sku || "N/A"}</p>
                    <p><strong>Kategori:</strong> ${
                      productData.category || "N/A"
                    }</p>
                    <p><strong>Brand:</strong> ${productData.brand || "N/A"}</p>
                    <p><strong>Berat:</strong> ${
                      productData.weight || "N/A"
                    } kg</p>
                    <p><strong>Dimensi:</strong> ${
                      productData.dimensions || "N/A"
                    } cm</p>
                    <p><strong>Material:</strong> ${
                      productData.material || "N/A"
                    }</p>
                    <p><strong>Kondisi:</strong> ${
                      productData.condition || "N/A"
                    }</p>
                  </div>
                </div>

                <div class="mb-6">
                  <h3
                    class="text-xl font-semibold text-gray-800 mb-3 flex items-center"
                  >
                    <i class="fas fa-file-invoice text-green-500 mr-2"></i> Deskripsi Lengkap
                  </h3>
                  <p class="text-gray-700 leading-relaxed text-sm">
                    ${
                      productData.fullDescription ||
                      "Tidak ada deskripsi lengkap."
                    }
                  </p>
                </div>

                <div class="mb-6">
                  <h3
                    class="text-xl font-semibold text-gray-800 mb-3 flex items-center"
                  >
                    <i class="fas fa-images text-purple-500 mr-2"></i> Galeri Gambar
                  </h3>
                  <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                    ${galleryImagesHtml}
                  </div>
                </div>
              </div>

              <div class="bg-white p-6 rounded-lg shadow-md">
                <h3
                  class="text-xl font-semibold text-gray-800 mb-4 flex items-center"
                >
                  <i class="fas fa-user-tie text-teal-600 mr-2"></i> Informasi Jastiper
                </h3>
                <div class="flex items-center mb-4">
                  <img
                    src="${jastiperInfo.photoUrl}"
                    alt="Foto Jastiper"
                    class="w-20 h-20 rounded-full object-cover mr-4 border-2 border-teal-400"
                  />
                  <div>
                    <p class="text-lg font-semibold text-gray-800">
                      ${jastiperInfo.name}
                    </p>
                    <p class="text-sm text-gray-600">ID Jastiper: ${
                      jastiperInfo.id || "N/A"
                    }</p>
                  </div>
                </div>
                <ul class="text-gray-700 space-y-2 text-sm">
                  <li>
                    <i class="fas fa-map-marker-alt text-gray-400 mr-2"></i> Lokasi Asal: ${
                      jastiperInfo.location
                    }
                  </li>
                  <li>
                    <i class="fas fa-envelope text-gray-400 mr-2"></i> Email:
                    <a
                      href="mailto:${jastiperInfo.email}"
                      class="text-blue-600 hover:underline"
                      >${jastiperInfo.email}</a
                    >
                  </li>
                  <li>
                    <i class="fas fa-phone-alt text-gray-400 mr-2"></i> Telepon:
                    <a href="tel:${
                      jastiperInfo.phone
                    }" class="text-blue-600 hover:underline"
                      >${jastiperInfo.phone}</a
                    >
                  </li>
                  <li class="mt-3">
                    <a
                      href="${jastiperInfo.profileUrl}"
                      class="text-blue-600 hover:text-blue-800 font-medium flex items-center"
                    >
                      Lihat Profil Jastiper
                      <i class="fas fa-arrow-right ml-2 text-xs"></i>
                    </a>
                  </li>
                </ul>
              </div>

              <div class="bg-white p-6 rounded-lg shadow-md">
                <h3
                  class="text-xl font-semibold text-gray-800 mb-4 flex items-center"
                >
                  <i class="fas fa-boxes text-orange-500 mr-2"></i> Stok & Varian
                </h3>
                <div class="overflow-x-auto">
                  <table class="min-w-full bg-white rounded-lg">
                    <thead>
                      <tr
                        class="bg-gray-100 text-gray-600 uppercase text-sm leading-normal"
                      >
                        <th class="py-3 px-6 text-left">Varian</th>
                        <th class="py-3 px-6 text-center">Stok</th>
                      </tr>
                    </thead>
                    <tbody class="text-gray-700 text-sm">
                      ${
                        productData.variants && productData.variants.length > 0
                          ? productData.variants
                              .map(
                                (variant) => `
                                <tr class="border-b border-gray-200 hover:bg-gray-50">
                                  <td class="py-3 px-6 text-left whitespace-nowrap">${
                                    variant.name || "N/A"
                                  }</td>
                                  <td class="py-3 px-6 text-center">
                                    <span
                                      class="${
                                        variant.stock > 10
                                          ? "bg-green-200 text-green-800"
                                          : variant.stock > 0
                                          ? "bg-yellow-200 text-yellow-800"
                                          : "bg-red-200 text-red-800"
                                      } py-1 px-3 rounded-full text-xs"
                                    >${
                                      variant.stock > 0
                                        ? `Tersedia (${variant.stock})`
                                        : "Habis (0)"
                                    }</span
                                    >
                                  </td>
                                </tr>
                              `
                              )
                              .join("")
                          : `<tr><td colspan="2" class="py-3 px-6 text-center text-gray-500">Tidak ada varian.</td></tr>`
                      }
                    </tbody>
                  </table>
                </div>
              </div>

              <div class="bg-white p-6 rounded-lg shadow-md">
                <h3
                  class="text-xl font-semibold text-gray-800 mb-4 flex items-center"
                >
                  <i class="fas fa-history text-blue-500 mr-2"></i> Riwayat Aktivitas
                </h3>
                <ul class="text-gray-700 space-y-3 text-sm">
                  <li class="flex items-start">
                    <i class="fas fa-calendar-alt text-gray-400 mr-3 mt-1"></i>
                    <div>
                      <strong>Dibuat:</strong> ${
                        productData.createdAt
                          ? new Date(
                              productData.createdAt.toDate()
                            ).toLocaleString("id-ID")
                          : "N/A"
                      }
                      <p class="text-xs text-gray-500">
                        Oleh:
                        <a
                          href="${jastiperInfo.profileUrl}"
                          class="text-blue-600 hover:underline"
                          >${jastiperInfo.name}</a
                        >
                      </p>
                    </div>
                  </li>
                  <li class="flex items-start">
                    <i class="fas fa-pencil-alt text-gray-400 mr-3 mt-1"></i>
                    <div>
                      <strong>Terakhir Diperbarui:</strong> ${
                        productData.updatedAt
                          ? new Date(
                              productData.updatedAt.toDate()
                            ).toLocaleString("id-ID")
                          : "N/A"
                      }
                      <p class="text-xs text-gray-500">
                        Oleh: ${productData.lastUpdatedBy || "Sistem"} (${
            productData.lastUpdateReason || "N/A"
          })
                      </p>
                    </div>
                  </li>
                  <li class="flex items-start">
                    <i class="fas fa-chart-line text-gray-400 mr-3 mt-1"></i>
                    <div>
                      <strong>Penjualan Terakhir:</strong> ${
                        productData.lastSoldDate
                          ? new Date(
                              productData.lastSoldDate.toDate()
                            ).toLocaleDateString("id-ID")
                          : "N/A"
                      } (${productData.lastSoldQuantity || 0} Pcs)
                      <p class="text-xs text-gray-500">Total Terjual: ${
                        productData.totalSold || 0
                      } Pcs</p>
                    </div>
                  </li>
                </ul>
              </div>

              <div class="bg-white p-6 rounded-lg shadow-md">
                <h3
                  class="text-xl font-semibold text-gray-800 mb-4 flex items-center"
                >
                  <i class="fas fa-globe text-orange-500 mr-2"></i> SEO & Metadata
                </h3>
                <ul class="text-gray-700 space-y-2 text-sm">
                  <li>
                    <strong>Meta Judul:</strong> ${
                      productData.metaTitle || productData.productName || "N/A"
                    } | TitipGo
                  </li>
                  <li>
                    <strong>Meta Deskripsi:</strong> ${
                      productData.metaDescription ||
                      productData.shortDescription ||
                      "N/A"
                    }
                  </li>
                  <li>
                    <strong>Keyword:</strong> ${
                      (productData.keywords || []).join(", ") || "N/A"
                    }
                  </li>
                  <li>
                    <strong>Slug URL:</strong> /produk/${productDoc.id}
                  </li>
                </ul>
              </div>
            `;

          // Update title dan breadcrumb
          pageTitleEl.textContent = `Detail Produk - ${
            productData.productName || "N/A"
          } - TitipGo Admin`;
          if (productDetailTitle)
            productDetailTitle.textContent = `Detail Produk: ${
              productData.productName || "N/A"
            }`;
          if (breadcrumbProductName)
            breadcrumbProductName.textContent =
              productData.productName || "N/A";

          // Tampilkan tombol aksi setelah data dimuat
          if (editProductButton) editProductButton.classList.remove("hidden");
          if (deleteProductButton)
            deleteProductButton.classList.remove("hidden");

          // --- Fungsionalitas Tombol Aksi Produk ---
          editProductButton.onclick = () => {
            // Arahkan ke halaman edit produk, misalnya:
            alert("Fungsi Edit Produk akan diarahkan ke halaman form edit.");
            // window.location.href = `admin-katalog-edit.html?id=${productId}`;
          };

          deleteProductButton.onclick = async () => {
            if (
              confirm(
                `Apakah Anda yakin ingin menghapus produk "${
                  productData.productName || "ini"
                }" secara permanen? Aksi ini tidak bisa dibatalkan!`
              )
            ) {
              try {
                await deleteDoc(productDocRef); // Menggunakan deleteDoc
                alert("Produk berhasil dihapus.");
                window.location.href = "admin-katalog.html"; // Redirect kembali ke daftar katalog
              } catch (error) {
                console.error("Error deleting product:", error);
                alert("Gagal menghapus produk. Coba lagi.");
              }
            }
          };
        } else {
          // Jika dokumen produk tidak ada di Firestore
          productDetailContent.innerHTML = `
              <div class="bg-white p-6 rounded-lg shadow-md mb-6 text-center">
                <p class="text-red-500 text-xl font-semibold">Produk dengan ID #${productId} tidak ditemukan.</p>
                <p class="text-gray-600 mt-2">Mungkin ID produk salah atau produk telah dihapus.</p>
                <div class="mt-4">
                  <a href="admin-katalog.html" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    <i class="fas fa-arrow-left mr-2"></i> Kembali ke Daftar Katalog
                  </a>
                </div>
              </div>
            `;
          pageTitleEl.textContent = `Produk Tidak Ditemukan - TitipGo Admin`;
          if (productDetailTitle)
            productDetailTitle.textContent = `Produk Tidak Ditemukan`;
          if (breadcrumbProductName)
            breadcrumbProductName.textContent = `Tidak Ditemukan`;
        }
      } catch (error) {
        console.error("Error fetching product detail:", error);
        let errorMessage = "Terjadi kesalahan yang tidak diketahui.";
        if (error.code === "unavailable") {
          errorMessage =
            "Gagal terhubung ke database. Pastikan Anda online atau periksa aturan keamanan Firebase Anda.";
        } else {
          errorMessage = error.message;
        }
        productDetailContent.innerHTML = `
            <div class="bg-white p-6 rounded-lg shadow-md mb-6 text-center">
              <p class="text-red-500 text-xl font-semibold">Terjadi kesalahan saat memuat detail produk.</p>
              <p class="text-gray-600 mt-2">Detail: ${errorMessage}</p>
              <div class="mt-4">
                <a href="admin-katalog.html" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                  <i class="fas fa-arrow-left mr-2"></i> Kembali ke Daftar Katalog
                </a>
              </div>
            </div>
          `;
        pageTitleEl.textContent = `Error - TitipGo Admin`;
        if (productDetailTitle)
          productDetailTitle.textContent = `Error Loading Product`;
        if (breadcrumbProductName) breadcrumbProductName.textContent = `Error`;
      }

      // --- Fungsionalitas Logout ---
      const logoutButton = document.getElementById("logoutButton");
      if (logoutButton) {
        logoutButton.addEventListener("click", async (e) => {
          e.preventDefault();
          try {
            await auth.signOut();
            alert("Anda telah logout!");
            window.location.href = "login.html"; // Arahkan ke halaman login Anda
          } catch (error) {
            console.error("Error during logout:", error);
            alert("Gagal logout: " + error.message);
          }
        });
      }
    </script>
  </body>
</html>
