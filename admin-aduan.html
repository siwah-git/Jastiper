<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <title>Manajemen Aduan - TitipGo Admin</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    #mainContent {
      background-image: linear-gradient(rgba(255, 255, 255, 0.3),
          rgba(255, 255, 255, 0.3)),
        url("asset/images/background.png");
      /* PASTIKAN PATH INI BENAR */
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      position: relative;
      overflow: hidden;
    }

    /* Pastikan konten di dalam mainContent berada di atas overlay */
    #mainContent>* {
      position: relative;
      z-index: 1;
    }

    /* Style untuk membuat background kartu statistik sedikit transparan */
    .card-bg-transparent {
      background-color: rgba(255,
          255,
          255,
          0.8);
      /* Putih dengan opasitas 80% */
    }

    .bg-white-transparent {
      background-color: rgba(255,
          255,
          255,
          0.85);
      /* Slightly transparent white */
    }

    .bg-blue-600-transparent {
      background-color: rgba(37,
          99,
          235,
          0.85);
      /* Slightly transparent blue */
    }

    .table-bg-transparent {
      background-color: rgba(255,
          255,
          255,
          0.7);
      /* More transparent for table body */
    }

    .header-bg-transparent {
      background-color: rgba(59,
          130,
          246,
          0.85);
      /* Tailwind's blue-500 equivalent with transparency */
    }
  </style>
</head>

<body class="font-sans antialiased">
  <div class="flex min-h-screen">
    <aside
      class="w-67 bg-white-transparent text-gray-800 flex flex-col justify-between shadow-lg fixed top-0 left-0 h-screen z-50">
      <div>
        <nav class="space-y-2 p-4">
          <img src="asset/images/logosiwah.png" alt="Logo" class="w-48 h-20 object-contain mb-4" />

          <a href="admin-dashboard.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
            <i class="fas fa-home mr-3"></i> Dashboard
          </a>
          <a href="admin-katalog.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
            <i class="fas fa-box mr-3"></i> Manajemen Katalog
          </a>
          <a href="admin-pengguna.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
            <i class="fas fa-users mr-3"></i> Manajemen Pengguna
          </a>
          <a href="admin-toko.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
            <i class="fas fa-store mr-3"></i> Manajemen Toko
          </a>
          <a href="admin-pesanan.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
            <i class="fas fa-shopping-cart mr-3"></i> Manajemen Pesanan
          </a>
          <a href="admin-aduan.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
            <i class="fas fa-envelope mr-3"></i> Aduan
          </a>
          <a href="admin-laporan.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
            <i class="fas fa-chart-line mr-3"></i> Laporan
          </a>
          <a href="admin-pendapatan.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
            <i class="fas fa-money-bill-wave mr-3"></i> Pendapatan
          </a>
          <a href="admin-profil.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
            <i class="fas fa-user-circle mr-3"></i> Profil
          </a>

          <a href="admin-tentang.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition">
            <i class="fas fa-info-circle mr-3"></i> Tentang Kami
          </a>
        </nav>
      </div>
      <footer class="text-sm text-gray-500 text-center p-4 border-t">
        &copy; 2025 TitipGo. All rights reserved.
      </footer>
    </aside>

    <main id="mainContent" class="ml-64 w-full p-6 overflow-y-auto min-h-screen">
      <div class="bg-blue-600 p-4 text-white flex items-center mb-6 rounded-lg">
        <p class="text-lg font-semibold">Manajemen Aduan</p>
        <div class="flex gap-3 text-right ml-auto">
          <a href="#" id="logoutButton"
            class="text-pink-100 hover:text-white button-pink-100 transition duration-200 ease-in-out px-4 py-2 rounded-md border border-pink-400 hover:bg-pink-700 text-sm flex items-center"><i
              class="fas fa-sign-out-alt mr-2"></i> Logout</a>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6">
        <div class="md:col-span-2 lg:col-span-3">
          <label for="search" class="sr-only">Cari</label>
          <div class="relative">
            <input type="text" id="search" placeholder="Cari..."
              class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:ring-pink-500 focus:border-pink-500 bg-white-transparent" />
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fas fa-search text-gray-400"></i>
            </div>
          </div>
        </div>
        <div class="md:col-span-1 lg:col-span-1">
          <label for="statusFilter" class="sr-only">Status</label>
          <select id="statusFilter"
            class="w-full p-2 border border-gray-300 rounded-md focus:ring-pink-500 focus:border-pink-500 bg-white-transparent">
            <option value="">Semua Status</option>
            <option value="Baru">Baru</option>
            <option value="Diproses">Diproses</option>
            <option value="Selesai">Selesai</option>
            <option value="Ditolak">Ditolak</option>
          </select>
        </div>
        <div class="md:col-span-1 lg:col-span-1">
          <label for="categoryFilter" class="sr-only">Kategori</label>
          <select id="categoryFilter"
            class="w-full p-2 border border-gray-300 rounded-md focus:ring-pink-500 focus:border-pink-500 bg-white-transparent">
            <option value="">Semua Kategori</option>
            <option value="Fashion">Fashion</option>
            <option value="Elektronik">Elektronik</option>
            <option value="Permak-Pernik">Permak-Pernik</option>
            <option value="Buku">Buku</option>
            <option value="Koleksi">Koleksi</option>
            <option value="Chat">Chat</option>
            <option value="Lainnya">Lainnya</option>
          </select>
        </div>
      </div>

      <div class="overflow-x-auto rounded-md border border-gray-200">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-blue-600 text-white">
            <tr>
              <th scope="col" class="py-3 px-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                No. Aduan
              </th>
              <th scope="col" class="py-3 px-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                Tanggal
              </th>
              <th scope="col" class="py-3 px-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                User
              </th>
              <th scope="col" class="py-3 px-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                Kategori
              </th>
              <th scope="col" class="py-3 px-4 text-left text-xs font-semibold text-white uppercase tracking-wider">
                Status
              </th>
              <th scope="col" class="py-3 px-4 text-center text-xs font-semibold text-white uppercase tracking-wider">
                Aksi
              </th>
            </tr>
          </thead>
          <tbody id="reportTableBody" class="divide-y divide-gray-200 table-bg-transparent"></tbody>
        </table>
      </div>

      <div class="mt-6 flex justify-between items-center">
        <div id="paginationInfo" class="text-sm text-gray-700"></div>
        <div id="paginationControls" class="flex"></div>
      </div>
    </main>
  </div>

  <script>
    // No Firebase configuration needed for dummy data

    const reportTableBody = document.getElementById("reportTableBody");
    const searchInput = document.getElementById("search");
    const statusFilter = document.getElementById("statusFilter");
    const categoryFilter = document.getElementById("categoryFilter");
    const paginationInfo = document.getElementById("paginationInfo");
    const paginationControls = document.getElementById("paginationControls");
    const logoutButton = document.getElementById("logoutButton");

    let allReports = []; // To store all reports (dummy data)
    let filteredReports = []; // To store reports after search and filter
    const itemsPerPage = 10;
    let currentPage = 1;

    // --- DUMMY DATA ---
    function generateDummyReports(count) {
      const statuses = ["Baru", "Diproses", "Selesai", "Ditolak"];
      const categories = ["Fashion", "Elektronik", "Permak-Pernik", "Buku", "Koleksi", "Chat", "Lainnya"];
      const users = ["Alice Smith", "Bob Johnson", "Charlie Brown", "Diana Prince", "Eve Adams"];
      const descriptions = [
        "Produk tidak sesuai deskripsi.",
        "Pengiriman sangat lambat.",
        "Ada masalah dengan pembayaran.",
        "Kualitas barang buruk.",
        "Respon chat dari toko lama.",
        "Barang rusak saat diterima.",
        "Penipuan oleh penjual.",
        "Masalah dengan pengembalian dana.",
        "Tidak dapat login ke akun.",
        "Pertanyaan umum tentang fitur aplikasi."
      ];

      const dummyData = [];
      for (let i = 1; i <= count; i++) {
        const timestamp = new Date(Date.now() - Math.floor(Math.random() * 30 * 24 * 60 * 60 * 1000)); // Last 30 days
        dummyData.push({
          id: `dummyReport${i}`, // Unique ID for dummy data
          reportId: `ADUAN-${String(i).padStart(4, '0')}`, // Sequential ID
          timestamp: {
            toDate: () => timestamp
          }, // Mock Firebase Timestamp.toDate()
          userId: `dummyUser${Math.floor(Math.random() * users.length)}`, // Dummy user ID
          userName: users[Math.floor(Math.random() * users.length)],
          category: categories[Math.floor(Math.random() * categories.length)],
          status: statuses[Math.floor(Math.random() * statuses.length)],
          description: descriptions[Math.floor(Math.random() * descriptions.length)],
          chatId: Math.random() < 0.3 ? `dummyChat${Math.floor(Math.random() * 5)}` : null, // Some reports linked to chat
        });
      }
      return dummyData.sort((a, b) => b.timestamp.toDate() - a.timestamp.toDate()); // Sort by newest first
    }

    // --- Core Functions (updated for dummy data) ---

    // Function to fetch reports (now uses dummy data)
    async function fetchReports() {
      reportTableBody.innerHTML = `<tr><td colspan="6" class="py-3 px-4 text-center text-sm text-gray-600">Memuat data aduan...</td></tr>`;

      // Simulate network delay
      await new Promise(resolve => setTimeout(resolve, 500));

      allReports = generateDummyReports(25); // Generate 25 dummy reports
      applyFiltersAndSearch(); // Apply filters and search after fetching
    }

    // Function to render table rows
    function renderTable(reportsToDisplay) {
      reportTableBody.innerHTML = ""; // Clear existing rows
      if (reportsToDisplay.length === 0) {
        reportTableBody.innerHTML = `<tr><td colspan="6" class="py-3 px-4 text-center text-sm text-gray-600">Tidak ada data aduan.</td></tr>`;
        paginationInfo.textContent = "Menampilkan 0 dari 0 data";
        paginationControls.innerHTML = "";
        return;
      }

      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      const paginatedReports = reportsToDisplay.slice(startIndex, endIndex);

      paginatedReports.forEach((report) => {
        const row = reportTableBody.insertRow();

        const statusClass =
          {
            Baru: "bg-blue-100 text-blue-800",
            Diproses: "bg-yellow-100 text-yellow-800",
            Selesai: "bg-green-100 text-green-800",
            Ditolak: "bg-red-100 text-red-800",
          }[report.status] || "bg-gray-100 text-gray-800"; // Default fallback

        const formattedDate = report.timestamp
          ? report.timestamp.toDate().toLocaleString("id-ID", {
            day: "2-digit",
            month: "long",
            year: "numeric",
            hour: "2-digit",
            minute: "2-digit",
          })
          : "-";

        row.innerHTML = `
                    <td class="py-3 px-4 text-sm text-gray-700">${report.reportId}</td>
                    <td class="py-3 px-4 text-sm text-gray-700">${formattedDate}</td>
                    <td class="py-3 px-4 text-sm text-gray-700">${report.userName}</td>
                    <td class="py-3 px-4 text-sm text-gray-700">${report.category || "-"}</td>
                    <td class="py-3 px-4 text-sm">
                        <span class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">${report.status || "Tidak Diketahui"}</span>
                    </td>
                    <td class="py-3 px-4 text-sm text-center flex justify-center space-x-2">
                        <a href="admin-aduan-detail.html?id=${report.id}" class="text-blue-600 hover:text-blue-900" title="Lihat Detail"><i class="fas fa-search"></i></a>
                        ${report.status === "Baru" || report.status === "Diproses" ? `
                        <a href="#" class="text-green-600 hover:text-green-900 set-status-btn" data-id="${report.id}" data-status="Selesai" title="Tandai Selesai"><i class="fas fa-check-circle"></i></a>
                        <a href="#" class="text-yellow-600 hover:text-yellow-900 set-status-btn" data-id="${report.id}" data-status="Diproses" title="Tandai Diproses"><i class="fas fa-hourglass-half"></i></a>
                        <a href="#" class="text-red-600 hover:text-red-900 set-status-btn" data-id="${report.id}" data-status="Ditolak" title="Tandai Ditolak"><i class="fas fa-times-circle"></i></a>
                        ` : ""}
                    </td>
                `;
      });
      attachStatusButtonListeners(); // Attach listeners after rendering
      updatePagination(reportsToDisplay.length);
    }

    // Function to attach event listeners to status change buttons
    function attachStatusButtonListeners() {
      document.querySelectorAll(".set-status-btn").forEach((button) => {
        button.removeEventListener("click", handleStatusChange); // Remove existing to prevent duplicates
        button.addEventListener("click", handleStatusChange);
      });
    }

    // Handle status change for dummy data
    async function handleStatusChange(event) {
      event.preventDefault();
      const reportId = event.currentTarget.dataset.id;
      const newStatus = event.currentTarget.dataset.status;

      if (confirm(`Apakah Anda yakin ingin mengubah status aduan ini menjadi "${newStatus}"?`)) {
        // Find the report in allReports and update its status
        const reportIndex = allReports.findIndex(report => report.id === reportId);
        if (reportIndex !== -1) {
          allReports[reportIndex].status = newStatus;
          alert(`Status aduan berhasil diubah menjadi "${newStatus}".`);
          applyFiltersAndSearch(); // Re-render with updated dummy data
        } else {
          alert("Aduan tidak ditemukan.");
        }
      }
    }

    // Function to apply search and filter
    function applyFiltersAndSearch() {
      const searchTerm = searchInput.value.toLowerCase();
      const selectedStatus = statusFilter.value;
      const selectedCategory = categoryFilter.value;

      filteredReports = allReports.filter((report) => {
        const matchesSearch =
          (report.reportId &&
            report.reportId.toLowerCase().includes(searchTerm)) ||
          (report.userName &&
            report.userName.toLowerCase().includes(searchTerm)) ||
          (report.description &&
            report.description.toLowerCase().includes(searchTerm)); // Assuming description can be searched

        const matchesStatus =
          selectedStatus === "" || report.status === selectedStatus;

        const matchesCategory =
          selectedCategory === "" || report.category === selectedCategory;

        return matchesSearch && matchesStatus && matchesCategory;
      });

      currentPage = 1; // Reset to first page after filtering/searching
      renderTable(filteredReports);
    }

    // Pagination functions
    function updatePagination(totalItems) {
      const totalPages = Math.ceil(totalItems / itemsPerPage);
      paginationInfo.textContent = `Menampilkan ${Math.min(
        (currentPage - 1) * itemsPerPage + 1,
        totalItems
      )} sampai ${Math.min(
        currentPage * itemsPerPage,
        totalItems
      )} dari ${totalItems} data`;

      paginationControls.innerHTML = "";

      const prevButton = document.createElement("button");
      prevButton.className =
        "px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-l-md hover:bg-gray-50";
      prevButton.textContent = "Previous";
      prevButton.disabled = currentPage === 1;
      prevButton.addEventListener("click", () => {
        if (currentPage > 1) {
          currentPage--;
          renderTable(filteredReports);
        }
      });
      paginationControls.appendChild(prevButton);

      for (let i = 1; i <= totalPages; i++) {
        const pageButton = document.createElement("button");
        pageButton.className = `px-4 py-2 text-sm font-medium ${i === currentPage
          ? "text-pink-600 bg-pink-100"
          : "text-gray-700 bg-white hover:bg-gray-50"
          } border border-gray-300`;
        pageButton.textContent = i;
        pageButton.addEventListener("click", () => {
          currentPage = i;
          renderTable(filteredReports);
        });
        paginationControls.appendChild(pageButton);
      }

      const nextButton = document.createElement("button");
      nextButton.className =
        "px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-r-md hover:bg-gray-50";
      nextButton.textContent = "Next";
      nextButton.disabled = currentPage === totalPages || totalPages === 0;
      nextButton.addEventListener("click", () => {
        if (currentPage < totalPages) {
          currentPage++;
          renderTable(filteredReports);
        }
      });
      paginationControls.appendChild(nextButton);
    }

    // Event listeners for search and filter
    searchInput.addEventListener("keyup", applyFiltersAndSearch);
    statusFilter.addEventListener("change", applyFiltersAndSearch);
    categoryFilter.addEventListener("change", applyFiltersAndSearch);

    // Logout Functionality (now just an alert, no actual Firebase signOut)
    logoutButton.addEventListener("click", async (e) => {
      e.preventDefault();
      alert("Anda telah logout (simulasi).");
      // window.location.href = "admin-login.html"; // Uncomment if you want to redirect to a dummy login page
    });

    // Sidebar active link logic
    document.addEventListener("DOMContentLoaded", () => {
      fetchReports(); // Initial fetch (now fetches dummy data)

      const currentPath = window.location.pathname;
      const sidebarLinks = document.querySelectorAll(".sidebar-item");

      sidebarLinks.forEach((link) => {
        const linkHref = link.getAttribute("href");
        const currentFilename = linkHref.substring(
          linkHref.lastIndexOf("/") + 1
        );

        let isLinkActive = false;

        // Check if the current page's filename matches the link's href
        if (currentPath.includes(currentFilename) && currentFilename !== "") {
          isLinkActive = true;
        } else if (currentFilename === "" && linkHref === "admin-dashboard.html") {
          // Special handling for dashboard if it's the root or index page
          isLinkActive = true;
        } else if (
          currentPath.includes("admin-aduan-detail.html") &&
          currentFilename === "admin-aduan.html"
        ) {
          // Special handling for detail page to highlight its parent link
          isLinkActive = true;
        }


        if (isLinkActive) {
          link.classList.remove(
            "text-gray-700",
            "hover:bg-pink-100",
            "hover:text-pink-600"
          );
          link.classList.add("bg-pink-600", "text-white", "font-semibold");
        } else {
          link.classList.remove("bg-pink-600", "text-white", "font-semibold");
          link.classList.add(
            "text-gray-700",
            "hover:bg-pink-100",
            "hover:text-pink-600"
          );
        }
      });
    });
  </script>
</body>

</html>