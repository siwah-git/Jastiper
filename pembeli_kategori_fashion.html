<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <title>Kategori - TitipGo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Peringatan: CDN Tailwind CSS tidak disarankan untuk produksi. Instal sebagai bagian dari build process Anda. -->
    <!-- Firebase SDKs dari CDN, sesuai dengan versi yang diimpor di firebase-config.js -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f5f7fa;
            padding-top: 80px;
            /* Tambahkan padding-top agar konten tidak tertutup header fixed */
        }

        .header-search {
            font-size: 1rem;
            height: 36px;
            padding-left: 2.2rem;
            padding-right: 1rem;
            border-radius: 9999px;
            width: 180px;
            font-weight: 600;
        }

        @media (min-width: 1024px) {
            .header-search {
                width: 220px;
            }
        }

        .header-search::placeholder {
            color: #a0aec0;
            opacity: 1;
            font-size: 1rem;
            font-weight: 600;
        }

        .icon-nav,
        nav svg {
            width: 20px !important;
            height: 20px !important;
            min-width: 20px;
            min-height: 20px;
        }

        .icon-nav:hover {
            filter: brightness(0.7);
        }

        /* Navigasi tengah di header */
        .main-nav-center {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1.5rem;
            /* Menyesuaikan jarak antar item */
        }

        .main-nav-center a,
        .main-nav-center .dropdown-kategori>a {
            padding: 0;
            font-size: 1rem;
            font-weight: 600;
            letter-spacing: 0.01em;
        }

        /* Gaya untuk dropdown */
        .dropdown-kategori .dropdown-content,
        #userDropdown {
            min-width: 160px;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.10);
            background: #fff;
            padding: 0;
            margin-top: 4px;
            /* Sedikit jarak dari item nav */
        }

        .dropdown-kategori .dropdown-content a,
        #userDropdown a {
            display: block;
            padding: 10px 18px;
            color: #222;
            text-decoration: none;
            font-size: 15px;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.15s, color 0.15s;
        }

        .dropdown-kategori .dropdown-content a:last-child,
        #userDropdown a:last-child {
            border-bottom: none;
        }

        .dropdown-kategori .dropdown-content a:hover,
        #userDropdown a:hover {
            background: #f5f7fa;
            color: #1976d2;
        }

        .logo-titipgo {
            width: 80px !important;
            min-width: 80px;
            max-width: 90px;
        }

        @media (max-width: 900px) {

            .icon-nav,
            nav svg {
                width: 16px !important;
                height: 16px !important;
            }

            .logo-titipgo {
                width: 60px !important;
            }

            .header-search {
                font-size: 0.9rem;
                height: 28px;
                width: 120px;
            }

            .header-search::placeholder {
                font-size: 0.9rem;
            }

            .main-nav-center a,
            .main-nav-center .dropdown-kategori>a {
                font-size: 0.9rem;
            }
        }

        /* Gaya untuk bagian kategori */
        .kategori-section {
            display: flex;
            /* Menggunakan flexbox */
            flex-wrap: wrap;
            /* Memungkinkan item untuk wrap ke baris berikutnya */
            justify-content: center;
            gap: 40px;
            /* Jarak antar item */
            margin: 0 auto;
            padding-top: 20px;
            max-width: 1200px;
            /* Lebar maksimum container kategori agar sesuai 5 kolom */
            /* Pastikan lebar ini cukup untuk 5 kolom + gap */
        }

        .kategori-col {
            text-align: center;
            /* Atur lebar kolom agar 5 kolom muat. */
            /* Setiap kolom diperkirakan sekitar 170px lebar, 5 * 170 = 850px. */
            /* Total gap: 4 * 40px = 160px. Jadi sekitar 850 + 160 = 1010px. */
            /* Kita gunakan calc untuk presisi */
            flex-basis: calc((100% - (4 * 40px)) / 5);
            /* 5 kolom dengan gap 40px */
            min-width: 170px;
            /* Pastikan kolom tidak terlalu kecil */
            flex-grow: 1;
            /* Memungkinkan kolom tumbuh jika ada ruang ekstra */
            flex-shrink: 1;
            /* Memungkinkan kolom menyusut jika perlu, tapi tidak di bawah min-width */
            box-sizing: border-box;
            /* Pastikan padding dan border termasuk dalam lebar */
        }

        /* Media query untuk memastikan 5 kolom pada layar besar */
        @media (min-width: 1100px) {

            /* Sesuaikan breakpoint ini agar 5 kolom terlihat optimal */
            .kategori-section {
                justify-content: center;
                /* Tetap center, atau space-evenly jika ingin merata */
            }

            .kategori-col {
                max-width: 170px;
                /* Atur lebar maksimum agar semua kolom memiliki lebar yang seragam */
                /* Ini akan membuat semua kolom berukuran sama jika ada cukup ruang */
            }
        }

        /* Media query untuk 3 kolom di layar sedang */
        @media (max-width: 1099px) and (min-width: 768px) {
            .kategori-col {
                flex-basis: calc((100% - (2 * 40px)) / 3);
                /* 3 kolom dengan gap 40px */
                max-width: calc((100% - (2 * 40px)) / 3);
            }
        }

        @media (max-width: 767px) {

            /* Untuk layar yang lebih kecil (mobile) */
            .kategori-section {
                flex-direction: column;
                align-items: center;
                gap: 24px;
                padding-top: 15px;
            }

            .kategori-col {
                min-width: 0;
                width: 90vw;
                /* Mengambil 90% lebar viewport */
                flex-basis: auto;
                /* Kembali ke lebar otomatis untuk mobile */
                max-width: none;
                /* Hapus batasan max-width */
            }

            .kategori-box {
                min-width: 0;
                width: 100%;
            }
        }

        .kategori-label {
            background: #ff0080;
            color: #fff;
            font-weight: bold;
            padding: 7px 22px;
            border-radius: 16px;
            display: inline-block;
            margin-bottom: 12px;
            font-size: 15px;
            letter-spacing: 0.5px;
            cursor: pointer;
            /* Menambahkan pointer untuk menunjukkan klik */
            transition: all 0.2s ease-in-out;
            /* Transisi untuk efek hover/klik */
        }

        .kategori-label:hover {
            transform: translateY(-2px);
            /* Efek hover */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* Gaya untuk kategori yang aktif */
        .kategori-label.active {
            border: 2px solid #a00040;
            /* Warna border yang lebih gelap untuk aktif */
            background-color: #d00060;
            /* Sedikit perubahan warna latar belakang */
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .kategori-box {
            background: #ededed;
            padding: 14px 24px;
            border-radius: 8px;
            text-align: left;
            min-width: 150px;
            /* Minimum width for the box content */
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04);
        }

        .kategori-box a {
            display: block;
            padding: 5px 0;
            font-size: 15px;
            color: #222;
            text-decoration: none;
            border-bottom: 1px solid #e0e0e0;
            transition: color 0.2s;
        }

        .kategori-box a:last-child {
            border-bottom: none;
        }

        .kategori-box a:hover {
            color: #ff0080;
        }

        /* Gaya untuk daftar produk dari Firestore */
        #products-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            /* Responsive grid */
            gap: 24px;
            /* Jarak antar produk */
            max-width: 1200px;
            /* Lebar maksimal container produk */
            margin: 36px auto;
            /* Tengah dan jarak atas */
            padding: 0 16px;
            /* Padding samping */
        }

        #products-list .product-card {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: transform 0.2s ease-in-out;
        }

        #products-list .product-card:hover {
            transform: translateY(-5px);
        }

        #products-list .product-card img {
            width: 150px;
            /* Ukuran gambar produk */
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        #products-list .product-card .product-name {
            font-weight: 700;
            font-size: 1.15rem;
            color: #ff0080;
            margin-bottom: 8px;
        }

        #products-list .product-card .product-price {
            font-size: 1rem;
            color: #333333;
            margin-bottom: 8px;
        }

        #products-list .product-card .product-description {
            font-size: 0.9rem;
            color: #666666;
            margin-bottom: 8px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            /* Batasi deskripsi hanya 2 baris */
            -webkit-box-orient: vertical;
        }

        #products-list .product-card .product-variants {
            font-size: 0.85rem;
            color: #888888;
        }

        #products-list .empty-message {
            grid-column: 1 / -1;
            /* Rentang seluruh kolom di grid */
            text-align: center;
            padding: 40px;
            font-size: 1.1rem;
            color: #777;
        }
    </style>
</head>

<body class="font-sans bg-gray-100 m-0">
    <header class="bg-white shadow-md py-1 px-6 flex justify-between items-center fixed w-full top-0 z-50 mb-8">
        <div class="flex items-center space-x-3">
            <img src="asset/images/titipgo_logo_remove.png" alt="Logo TitipGo" class="w-28 sm:w-32">
            <div class="relative hidden md:block">
                <input type="text" placeholder="Cari Barang..."
                    class="header-search pl-10 pr-4 py-2 border border-gray-300 rounded-full w-56 lg:w-64 focus:outline-none focus:border-pink-500">
                <svg class="w-5 h-5 absolute left-2.5 top-2.5 text-gray-500 pointer-events-none" fill="currentColor"
                    viewBox="0 0 20 20">
                    <path
                        d="M8 4a4 4 0 104 4 4 4 0 00-4-4zM2 8a6 6 0 1110.39 3.94l4.3 4.3-1.42 1.42-4.3-4.3A6 6 0 012 8z" />
                </svg>
            </div>
        </div>
        <nav class="nav-center flex-grow hidden md:flex justify-center items-center gap-6">
        </nav>
        <nav class="flex items-center space-x-4 sm:space-x-6">
            <a href="pembeli_dashboard.html"
                class="hidden md:block text-gray-700 hover:text-pink-600 font-semibold text-base">Beranda</a>
            <div class="dropdown-kategori relative inline-block hidden md:block">
                <a href="pembeli_kategori.html"
                    class="hidden md:block text-gray-700 hover:text-pink-600 font-semibold text-base">Kategori</a>
                <div class="dropdown-kategori relative inline-block hidden md:block"></div>
            </div>

            <a href="pembeli_keranjang.html" class="relative p-2 text-gray-700 hover:text-pink-600">
                <svg class="icon-nav w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z">
                    </path>
                </svg>
            </a>
            <a href="pembeli_notifikasi.html" class="relative p-2 text-gray-700 hover:text-pink-600"> <svg
                    class="icon-nav w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9">
                    </path>
                </svg>
            </a>
            <img src="https://cdn-icons-png.flaticon.com/512/747/747376.png" alt="User" class="icon-nav w-6 h-6"
                id="userIcon" style="cursor:pointer;">
            <div id="userDropdown"
                class="hidden absolute right-0 top-[60px] bg-white shadow-lg rounded min-w-[160px] z-[1001]">
                <a href="pembeli_akun.html"
                    class="block px-5 py-3 text-gray-900 no-underline text-sm border-b border-gray-100">Akun Saya</a>
                <a href="pembeli_pesanan_saya.html"
                    class="block px-5 py-3 text-gray-900 no-underline text-sm border-b border-gray-100">Pesanan</a>
                <a href="#" onclick="openChatCS();return false;"
                    class="block px-5 py-3 text-gray-700 no-underline text-sm border-b border-gray-100">Chat dengan
                    CS</a>
                <a href="#" onclick="openTokoSaya();return false;"
                    class="block px-5 py-3 text-gray-700 no-underline text-sm border-b border-gray-100">Toko Saya</a>
                <a href="#" onclick="logoutUser();return false;"
                    class="block px-5 py-3 text-red-600 no-underline text-sm">Logout</a>
            </div>
        </nav>
    </header>
    <h1 class="page-title"
        style="text-align:center;font-size:2rem;font-weight:bold;margin:32px 0 16px 0;letter-spacing:1px;">KATEGORI
    </h1>
    <div class="text-center mb-6">

    </div>
    <div class="kategori-section flex flex-wrap justify-center gap-8 md:gap-12">
        <div class="kategori-col flex flex-col items-center">
            <div class="kategori-label bg-pink-600 text-white font-bold px-6 py-2 rounded-full mb-3 text-base cursor-pointer"
                onclick="filterByCategory('Fashion & Aksesoris')">Fashion & Aksesoris</div>
            <div class="kategori-box bg-gray-100 rounded-lg shadow p-5 w-48 text-left">
                <a href="pembeli_kategori_fashion.html"
                    class="block py-1 border-b border-gray-200 last:border-b-0">Pakaian</a>
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Sepatu</a>
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Sandal</a>
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Tas</a>
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Dompet</a>
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Jam Tangan</a>

            </div>
        </div>
        <div class="kategori-col flex flex-col items-center">
            <div class="kategori-label bg-pink-600 text-white font-bold px-6 py-2 rounded-full mb-3 text-base cursor-pointer"
                onclick="filterByCategory('Kosmetik & Skincare')">Kosmetik & Skincare</div>
            <div class="kategori-box bg-gray-100 rounded-lg shadow p-5 w-48 text-left">
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Skincare</a>
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Makeup</a>
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Perawatan Rambut</a>
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Body Care</a>
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Masker Wajah</a>
                <a href="#" class="block py-1">Produk Khusus</a>
            </div>
        </div>
        <div class="kategori-col flex flex-col items-center">
            <div class="kategori-label bg-pink-600 text-white font-bold px-6 py-2 rounded-full mb-3 text-base cursor-pointer"
                onclick="filterByCategory('Elektronik & Gadget')">Elektronik & Gadget</div>
            <div class="kategori-box bg-gray-100 rounded-lg shadow p-5 w-48 text-left">
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Smartphone</a>
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Aksesoris Gadget</a>
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Kamera</a>
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Smartwatch</a>
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Alat Elektronik</a>
                <a href="#" class="block py-1">Gaming</a>
            </div>
        </div>
        <div class="kategori-col flex flex-col items-center">
            <div class="kategori-label bg-pink-600 text-white font-bold px-6 py-2 rounded-full mb-3 text-base cursor-pointer"
                onclick="filterByCategory('Makanan & Minuman')">Makanan & Minuman</div>
            <div class="kategori-box bg-gray-100 rounded-lg shadow p-5 w-48 text-left">
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Snack</a>
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Minuman</a>
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Bumbu</a>
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Makanan</a>
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Cokelat & permen</a>
                <a href="#" class="block py-1">Oleh-oleh musiman</a>
            </div>
        </div>
        <div class="kategori-col flex flex-col items-center">
            <div class="kategori-label bg-pink-600 text-white font-bold px-6 py-2 rounded-full mb-3 text-base cursor-pointer"
                onclick="filterByCategory('Mainan Anak-Anak')">Mainan Anak-Anak</div>
            <div class="kategori-box bg-gray-100 rounded-lg shadow p-5 w-48 text-left">
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Mainan anak</a>
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Action figure</a>
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Puzzle & board game</a>
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Model kit</a>
                <a href="#" class="block py-1 border-b border-gray-200 last:border-b-0">Alat Gambar</a>
                <a href="#" class="block py-1">Robot</a>
            </div>
        </div>
    </div>
    <div id="products-list" class="mt-6"></div>
    <footer class="bg-blue-900 py-8 px-6 mt-8">
        <div class="container mx-auto flex flex-wrap justify-between items-start text-white text-sm">
            <div class="w-full sm:w-1/3 mb-6 sm:mb-0">
                <h3 class="font-bold text-white mb-3">INFORMASI</h3>
                <ul>
                    <li class="mb-2"><a href="pembeli_tentang_kami.html" class="hover:text-pink-600">Tentang Kami</a>
                    </li>
                    <li class="mb-2"><a href="pembeli_pertanyaan_umum.html" class="hover:text-pink-600">Pertanyaan
                            Umum</a></li>
                    <li class="mb-2"><a href="pembeli_hubungi_kami.html" class="hover:text-pink-600">Hubungi Kami</a>
                    </li>
                </ul>
            </div>
            <div class="w-full sm:w-1/3 flex justify-center items-center mb-6 sm:mb-0">
                <img src="asset/images/titipgo_logo_remove.png" alt="TitipGo Logo" class="w-32">
            </div>
            <div class="w-full sm:w-1/3 text-right">
                <h3 class="font-bold text-white mb-3">IKUTI SOSIAL MEDIA KAMI</h3>
                <ul>
                    <li class="mb-2 flex items-center justify-end"><i class="fab fa-instagram mr-2"></i><a
                            href="https://www.instagram.com/restiidr_?igsh=MXkwbXQ5OHgxdnJteQ%3D%3D&utm_source=qr"
                            target="_blank" class="hover:text-pink-600">Instagram</a></li>
                    <li class="mb-2 flex items-center justify-end"><i class="fab fa-facebook mr-2"></i><a
                            href="https://www.instagram.com/sitiiwhy_?igsh=MTk4aWtnbTBmaWZyZQ==" target="_blank"
                            class="hover:text-pink-600">Facebook</a></li>
                    <li class="mb-2 flex items-center justify-end"><i class="fab fa-youtube mr-2"></i><a
                            href="https://www.instagram.com/okay_5527?igsh=MXVkODNpNTNrZ3kwbg==" target="_blank"
                            class="hover:text-pink-600">Youtube</a></li>
                </ul>
            </div>
        </div>
        <div class="text-center text-white text-xs mt-8 opacity-75"> © 2025 TitipGo. All rights reserved.
        </div>
    </footer>
    <script>
        // Dropdown Kategori
        const kategoriMenu = document.getElementById('kategoriMenu');
        const dropdownKategori = document.getElementById('dropdownKategori');
        if (kategoriMenu && dropdownKategori) {
            kategoriMenu.addEventListener('click', function (e) {
                e.preventDefault();
                dropdownKategori.style.display = dropdownKategori.style.display === 'block' ? 'none' : 'block';
            });
            document.addEventListener('click', function (e) {
                if (!kategoriMenu.contains(e.target) && !dropdownKategori.contains(e.target)) {
                    dropdownKategori.style.display = 'none';
                }
            });
        }
        // Dropdown User
        const userIcon = document.getElementById('userIcon');
        const userDropdown = document.getElementById('userDropdown');
        if (userIcon && userDropdown) {
            userIcon.onclick = function (e) {
                e.stopPropagation();
                userDropdown.classList.toggle('hidden');
            };
            document.addEventListener('click', function (e) {
                if (!userDropdown.contains(e.target) && e.target !== userIcon) {
                    userDropdown.classList.add('hidden');
                }
            });
        }

        function logoutUser() {
            alert('Berhasil logout!');
            // Implementasi logout Firebase akan ditambahkan di sini jika diperlukan
            if (userDropdown) userDropdown.classList.add('hidden');
            // Redirect ke halaman login setelah logout, contoh:
            // window.location.href = 'pembeli_login.html';
        }

        function openChatCS() {
            alert('Fitur chat CS akan segera hadir!');
            if (userDropdown) userDropdown.classList.add('hidden');
        }

        // Placeholder function for "Toko Saya"
        function openTokoSaya() {
            alert('Fitur Toko Saya akan segera hadir!');
            if (userDropdown) userDropdown.classList.add('hidden');
        }
    </script>
    <script type="module">
        // Mengimpor db dari firebase-config.js
        import { db } from './js/firebase-config.js';
        // Mengimpor fungsi Firestore yang diperlukan
        import { collection, getDocs, query, where } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';

        let currentFilter = null; // Menyimpan filter kategori yang sedang aktif

        // Fungsi untuk memuat produk dari Firestore
        async function loadProductsFromFirestore(categoryFilter = null) {
            const productsListContainer = document.getElementById('products-list');
            // Menghapus pesan loading awal atau konten sebelumnya
            productsListContainer.innerHTML = '<div class="empty-message">Memuat produk...</div>';

            try {
                let q;
                // Mengambil data dari koleksi "produk"
                if (categoryFilter) {
                    // Jika filter kategori diterapkan, buat kueri dengan klausa where pada bidang "jenis"
                    q = query(collection(db, "produk"), where("jenis", "==", categoryFilter));
                } else {
                    // Jika tidak ada filter, ambil semua produk dari koleksi "produk"
                    q = collection(db, "produk");
                }

                const querySnapshot = await getDocs(q);
                const products = [];
                // Iterasi melalui setiap dokumen dan tambahkan ke array products
                querySnapshot.forEach((doc) => {
                    products.push({ id: doc.id, ...doc.data() });
                });

                // Jika tidak ada produk, tampilkan pesan kosong
                if (!products.length) {
                    productsListContainer.innerHTML = '<div class="empty-message">Belum ada produk yang tersedia untuk kategori ini.</div>';
                    return;
                }

                // Render produk ke dalam HTML
                productsListContainer.innerHTML = products.map(product => `
                    <div class="product-card">
                        <img src="${product.gambar || 'https://placehold.co/150x150/cccccc/333333?text=No+Image'}" 
                             alt="${product.nama}" 
                             onerror="this.onerror=null;this.src='https://placehold.co/150x150/cccccc/333333?text=No+Image';" />
                        <div class="product-name">${product.nama}</div>
                        <div class="product-price">Rp. ${product.harga ? product.harga.toLocaleString('id-ID') : 'N/A'}</div>
                        <div class="product-description">${product.deskripsi || 'Tidak ada deskripsi.'}</div>
                        <div class="product-variants">Varian: ${product.varian && Array.isArray(product.varian) && product.varian.length > 0 ? product.varian.join(', ') : 'Tidak ada varian'}</div>
                    </div>
                `).join('');

            } catch (error) {
                console.error("Error fetching products: ", error);
                productsListContainer.innerHTML = '<div class="empty-message">Gagal memuat produk. Silakan coba lagi nanti.</div>';
            }
        }

        // Fungsi untuk menangani klik kategori
        window.filterByCategory = function (categoryName) {
            currentFilter = categoryName;
            loadProductsFromFirestore(categoryName);
            updateCategoryHighlight(categoryName);
        };

        // Fungsi untuk menghapus filter kategori
        window.clearCategoryFilter = function () {
            currentFilter = null;
            loadProductsFromFirestore();
            updateCategoryHighlight(null);
        };

        // Fungsi untuk memperbarui sorotan visual kategori aktif
        function updateCategoryHighlight(activeCategory) {
            // Hapus kelas 'active' dari semua kategori label
            document.querySelectorAll('.kategori-label').forEach(label => {
                label.classList.remove('active');
            });

            // Tambahkan kelas 'active' ke kategori yang dipilih
            if (activeCategory) {
                const selectedLabel = Array.from(document.querySelectorAll('.kategori-label'))
                    .find(label => label.textContent.trim() === activeCategory);
                if (selectedLabel) {
                    selectedLabel.classList.add('active');
                }
            } else {
                // Jika tidak ada filter, sorot tombol "Lihat Semua Produk"
                const allProductsButton = document.getElementById('allProductsButton');
                if (allProductsButton) {
                    allProductsButton.classList.add('active');
                }
            }
        }

        // Panggil fungsi saat DOM sudah dimuat sepenuhnya
        window.addEventListener('DOMContentLoaded', () => {
            loadProductsFromFirestore(); // Muat semua produk awalnya
            updateCategoryHighlight(null); // Sorot "Lihat Semua Produk" awalnya
        });
    </script>
</body>

</html>