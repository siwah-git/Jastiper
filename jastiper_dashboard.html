<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard Jastiper - TitipGo</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      /* Kustom CSS untuk background image dan overlay pada main content */
      #mainContent {
        background-image: linear-gradient(
            rgba(255, 255, 255, 0.3),
            rgba(255, 255, 255, 0.3)
          ),
          url("asset/images/background.png");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        position: relative;
        overflow: hidden;
      }

      /* Pastikan konten di dalam mainContent berada di atas overlay */
      #mainContent > * {
        position: relative;
        z-index: 1;
      }

      /* Style untuk membuat background kartu statistik sedikit transparan */
      .card-bg-transparent {
        background-color: rgba(
          255,
          255,
          255,
          0.8
        ); /* Putih dengan opasitas 80% */
      }

      /* Adjustments for sidebar to match the admin dashboard look */
      aside {
        width: 250px; /* Adjust if needed to match admin width, original was 250px, admin was 67, setting to 250px as it was originally */
      }

      /* Overview Boxes in "Yang Perlu Dilakukan" - MODIFIED from Jastiper CSS */
      .overview-grid {
        display: grid; /* Changed from flex to grid for better responsiveness */
        grid-template-columns: repeat(
          auto-fit,
          minmax(120px, 1fr)
        ); /* Responsive columns */
        gap: 1rem; /* Gap between grid items */
        padding: 0; /* Remove padding from grid itself, cards have their own */
        margin-bottom: 1.5rem;
      }

      .overview-box {
        background-color: rgba(
          255,
          255,
          255,
          0.9
        ); /* Slightly transparent white for consistency */
        border-radius: 0.75rem; /* Rounded corners */
        padding: 1.5rem; /* Consistent padding with other cards */
        text-align: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); /* Soft shadow */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center; /* Center content vertically */
        position: relative;
        overflow: hidden; /* Hide overflowing background icons if any */
      }

      /* No vertical separator needed with grid layout and consistent card styling */
      .overview-box::after {
        content: none !important;
      }

      .overview-box .number {
        font-size: 2.25rem; /* Larger font size */
        font-weight: 700; /* Bold font weight */
        line-height: 1.2;
        color: #ec4899; /* Pink color */
        margin-bottom: 0.25rem;
        position: relative;
        z-index: 1;
      }

      .overview-box .label {
        font-size: 0.9rem; /* Slightly larger label font */
        color: #555;
        font-weight: 500;
        position: relative;
        z-index: 1;
      }

      /* Background icons for statistik boxes - kept from Jastiper CSS */
      .statistik-box::before {
        content: "";
        position: absolute;
        opacity: 0.08;
        z-index: 0;
        pointer-events: none;
        background-repeat: no-repeat;
        background-position: center;
        background-size: 60%;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }

      .statistik-box.pengunjung::before {
        background-image: url("https://i.ibb.co/5c94wFk/eye-icon.png");
      }

      .statistik-box.pesanan::before {
        background-image: url("https://i.ibb.co/h9r746x/cart-icon.png");
      }

      .statistik-box.produk-dilihat::before {
        background-image: url("https://i.ibb.co/P44n01S/product-view-icon.png");
      }
    </style>
  </head>
  <body class="bg-gray-100 font-sans antialiased">
    <div class="flex min-h-screen">
      <aside
        class="w-67 bg-white text-gray-800 flex flex-col justify-between shadow-lg fixed top-0 left-0 h-screen z-50"
      >
        <div>
          <nav class="space-y-2 p-4">
            <img
              src="asset/images/titipgo_logo_remove.png"
              alt="Logo"
              class="w-48 h-20 object-contain mb-4"
            />

            <a
              href="jastiper_dashboard.html"
              class="sidebar-item block py-2 px-4 rounded-md text-white bg-pink-600 font-semibold"
            >
              <i class="fas fa-clipboard-list mr-3"></i> To-Do List
            </a>
            <a
              href="jastiper_toko_kita.html"
              class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition"
            >
              <i class="fas fa-store mr-3"></i> Toko Kita
            </a>
            <a
              href="jastiper_chat.html"
              class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition"
            >
              <i class="fas fa-comments mr-3"></i> Chat
            </a>
            <a
              href="#"
              id="logout-button-sidebar"
              class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition"
            >
              <i class="fas fa-sign-out-alt mr-3"></i> Logout
            </a>
          </nav>
        </div>
        <footer class="text-sm text-gray-500 text-center p-4 border-t">
          &copy; 2025 TitipGo. All rights reserved.
        </footer>
      </aside>

      <main
        id="mainContent"
        class="ml-64 w-full p-6 overflow-y-auto"
        style="
          background-image: linear-gradient(
              rgba(255, 255, 255, 0.3),
              rgba(255, 255, 255, 0.3)
            ),
            url('asset/images/background.png');
          background-size: cover;
          background-position: center;
          background-repeat: no-repeat;
        "
      >
        <div
          class="bg-blue-600 p-4 text-white flex items-center mb-6 rounded-lg"
        >
          <p class="text-lg font-semibold">
            Selamat datang di Dashboard Jastiper!
          </p>
          <div class="flex gap-3 text-right ml-auto">
            <a
              href="#"
              id="logout-button-main"
              class="text-pink-100 hover:text-white button-pink-100 transition duration-200 ease-in-out px-4 py-2 rounded-md border border-pink-400 hover:bg-pink-700 text-sm flex items-center"
              ><i class="fas fa-sign-out-alt mr-2"></i> Logout</a
            >
          </div>
        </div>

        <div class="card-bg-transparent p-6 rounded shadow mb-6">
          <h2 class="text-lg font-bold mb-1">Yang Perlu Dilakukan</h2>
          <p class="text-sm text-gray-500 mb-3">
            Hal-hal yang perlu Anda tangani
          </p>
          <div class="overview-grid">
            <div class="overview-box">
              <p class="number" id="count-belum-bayar">0</p>
              <p class="label">Belum Bayar</p>
            </div>
            <div class="overview-box">
              <p class="number" id="count-pengiriman-diproses">0</p>
              <p class="label">Pengiriman Diproses</p>
            </div>
            <div class="overview-box">
              <p class="number" id="count-perlu-diproses">0</p>
              <p class="label">Pesanan Perlu Diproses</p>
            </div>
            <div class="overview-box">
              <p class="number" id="count-pengikut-toko">0</p>
              <p class="label">Pengikut Toko</p>
            </div>
            <div class="overview-box">
              <p class="number" id="count-produk-diblokir">0</p>
              <p class="label">Produk Diblokir</p>
            </div>
            <div class="overview-box">
              <p class="number" id="count-produk-habis">0</p>
              <p class="label">Produk Habis</p>
            </div>
          </div>
          <div class="text-right">
            <button
              class="btn-pesanan bg-pink-600 text-white py-2 px-4 rounded-md font-semibold hover:bg-pink-700 transition shadow-md"
            >
              Pesanan
            </button>
          </div>
        </div>

        <div class="mb-6 grid grid-cols-1 lg:grid-cols-3 gap-4">
          <div class="lg:col-span-2 card-bg-transparent p-6 rounded shadow">
            <h2 class="text-lg font-bold mb-2">Performa Toko</h2>
            <p class="text-sm text-gray-500 mb-3">
              Tinjauan Toko - Penjualan hari ini
            </p>
            <div style="height: 200px">
              <canvas id="salesChart"></canvas>
            </div>
          </div>

          <div
            class="lg:col-span-1 grid grid-cols-1 md:grid-cols-3 lg:grid-cols-1 gap-4"
          >
            <div class="statistik-box pengunjung card-bg-transparent">
              <p class="value" id="count-total-pengunjung">46</p>
              <p class="label">Total Pengunjung</p>
            </div>
            <div class="statistik-box pesanan card-bg-transparent">
              <p class="value" id="count-total-pesanan-berhasil">0</p>
              <p class="label">Pesanan Berhasil</p>
            </div>
            <div class="statistik-box produk-dilihat card-bg-transparent">
              <p class="value" id="count-produk-dilihat">46</p>
              <p class="label">Produk yang dilihat</p>
            </div>
          </div>
        </div>
      </main>
    </div>

    <div id="logout-modal" class="modal-overlay">
      <div class="modal-content">
        <h3 class="text-xl font-semibold mb-4">Konfirmasi Logout</h3>
        <p class="text-gray-700">
          Apakah Anda yakin ingin keluar dari akun ini?
        </p>
        <div class="modal-buttons">
          <button id="cancel-logout" class="btn-cancel">Batal</button>
          <button id="confirm-logout" class="btn-confirm">Logout</button>
        </div>
      </div>
    </div>

    <script type="module">
      // No Firebase configuration needed as connections are removed.
      // const firebaseConfig = { ... };

      // Firebase initialization removed
      // const app = firebase.initializeApp(firebaseConfig);
      // const db = firebase.firestore();
      // const auth = firebase.auth();

      let currentJastiperId = null; // No longer dynamic, just a placeholder.

      // Firebase Auth state change listener removed
      // auth.onAuthStateChanged((user) => { ... });

      // Get DOM elements for counts in "Yang Perlu Dilakukan"
      const countBelumBayar = document.getElementById("count-belum-bayar");
      const countPengirimanDiproses = document.getElementById(
        "count-pengiriman-diproses"
      );
      const countPerluDiproses = document.getElementById(
        "count-perlu-diproses"
      );
      const countPengikutToko = document.getElementById("count-pengikut-toko");
      const countProdukDiblokir = document.getElementById(
        "count-produk-diblokir"
      );
      const countProdukHabis = document.getElementById("count-produk-habis");

      // Get DOM elements for counts in "Performa Toko"
      const countTotalPengunjung = document.getElementById(
        "count-total-pengunjung"
      );
      const countTotalPesananBerhasil = document.getElementById(
        "count-total-pesanan-berhasil"
      );
      const countProdukDilihat = document.getElementById(
        "count-produk-dilihat"
      );

      // Logout Modal elements
      const logoutButtonSidebar = document.getElementById(
        "logout-button-sidebar"
      );
      const logoutButtonMain = document.getElementById("logout-button-main"); // New ID for logout in main content
      const logoutModal = document.getElementById("logout-modal");
      const cancelLogoutButton = document.getElementById("cancel-logout");
      const confirmLogoutButton = document.getElementById("confirm-logout");

      let salesChartInstance = null; // To store the Chart.js instance

      // All Firebase-related functions are replaced with static updates or removed.

      // Function to simulate fetching and displaying counts (now static)
      function fetchToDoCounts() {
        // These values are now hardcoded or left at their initial HTML values (0)
        countBelumBayar.textContent = "5"; // Example static value
        countPengirimanDiproses.textContent = "2"; // Example static value
        countPerluDiproses.textContent = "3"; // Example static value
        countPengikutToko.textContent = "120"; // Example static value
        countProdukDiblokir.textContent = "1"; // Example static value
        countProdukHabis.textContent = "7"; // Example static value
      }

      // Function to simulate fetching sales data for the chart and total successful orders (now static)
      function fetchSalesDataAndSuccessfulOrders() {
        countTotalPesananBerhasil.textContent = "50"; // Example static value

        // Static data for the chart
        const labels = Array.from(
          { length: 24 },
          (_, i) => `${String(i).padStart(2, "0")}:00`
        );
        const data = Array.from(
          { length: 24 },
          () => Math.floor(Math.random() * 5000000) + 100000
        ); // Random sales data

        // Destroy old chart instance if it exists
        if (salesChartInstance) {
          salesChartInstance.destroy();
        }

        const ctx = document.getElementById("salesChart").getContext("2d");
        salesChartInstance = new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Penjualan (Rp)",
                data: data,
                backgroundColor: "rgba(236, 72, 153, 0.7)", // Pink color
                borderColor: "rgba(236, 72, 153, 1)",
                borderWidth: 1,
                borderRadius: 4,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return `Rp ${context.raw.toLocaleString("id-ID")}`;
                  },
                },
              },
            },
            scales: {
              x: {
                grid: {
                  display: false,
                },
                title: {
                  display: true,
                  text: "Jam",
                  color: "#4A5568", // gray-700
                },
              },
              y: {
                beginAtZero: true,
                grid: {
                  color: "#eee",
                },
                ticks: {
                  callback: function (value) {
                    return `Rp ${value.toLocaleString("id-ID")}`;
                  },
                },
                title: {
                  display: true,
                  text: "Jumlah Penjualan",
                  color: "#4A5568", // gray-700
                },
              },
            },
          },
        });
      }

      // Function to simulate fetching traffic data (now static)
      function fetchTrafficData() {
        // These values are now hardcoded or left at their initial HTML values (46)
        // If you want dynamic, you'd integrate with your new backend.
        countTotalPengunjung.textContent = "1500"; // Example static value
        countProdukDilihat.textContent = "3200"; // Example static value
      }

      // Main function to load all dashboard data
      function loadDashboardData() {
        fetchToDoCounts();
        fetchSalesDataAndSuccessfulOrders();
        fetchTrafficData();
      }

      // Event listener for logout button (opens modal) - both sidebar and main content
      logoutButtonSidebar.addEventListener("click", () => {
        logoutModal.classList.add("show");
      });

      logoutButtonMain.addEventListener("click", () => {
        logoutModal.classList.add("show");
      });

      // Event listener for "Cancel" button in modal
      cancelLogoutButton.addEventListener("click", () => {
        logoutModal.classList.remove("show");
      });

      // Event listener for "Logout" button in modal (no actual Firebase logout)
      confirmLogoutButton.addEventListener("click", () => {
        console.log("Simulating logout (no Firebase connection).");
        // You might redirect the user to a login page or home page here
        alert("Anda telah logout (simulasi).");
        logoutModal.classList.remove("show"); // Close modal
        // Remove any locally stored 'session' data if applicable for your new system.
        // localStorage.removeItem('jastiperId'); // No longer needed as we removed Firebase
      });

      // --- Skrip untuk highlight sidebar item (dari kode Admin Dashboard) ---
      document.addEventListener("DOMContentLoaded", function () {
        const currentPath = window.location.pathname.split("/").pop(); // Ambil nama file dari URL
        const sidebarLinks = document.querySelectorAll(".sidebar-item");

        sidebarLinks.forEach((link) => {
          const linkHref = link.getAttribute("href");
          const linkFileName = linkHref.split("/").pop(); // Ambil nama file dari href

          let isLinkActive = false;

          if (currentPath === linkFileName) {
            isLinkActive = true;
          } else if (
            currentPath === "" &&
            linkFileName === "jastiper-dashboard.html"
          ) {
            // Menangani kasus jika URL adalah root domain/localhost/ tanpa nama file, dan dashboard adalah default
            isLinkActive = true;
          }

          if (isLinkActive) {
            link.classList.remove(
              "text-gray-700",
              "hover:bg-pink-100",
              "hover:text-pink-600"
            );
            link.classList.add("bg-pink-600", "text-white", "font-semibold");
          } else {
            link.classList.remove("bg-pink-600", "text-white", "font-semibold");
            link.classList.add(
              "text-gray-700",
              "hover:bg-pink-100",
              "hover:text-pink-600"
            );
          }
        });
      });

      // Load data when the DOM is fully loaded
      document.addEventListener("DOMContentLoaded", loadDashboardData);
    </script>
  </body>
</html>
