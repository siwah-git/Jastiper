<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Beranda - TitipGo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome untuk ikon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        xintegrity="sha512-ieCDL2m3wD6P1L3+6o5u3Q9mQ5vG7yJ+zL3F0B5W6j8U7z6T7dC4xTj8yM1Q0/6QG6r7s5E12/wA8kS/oA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Firebase SDKs (Tidak perlu lagi memuat file compat secara terpisah di sini karena sudah diimpor modular dari firebase-config.js) -->

    <style>
        /* Custom CSS untuk overriding atau menambahkan style Tailwind */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #ffffff;
        }

        .hero-section {
            transition: background-image 1s ease-in-out;
            background-size: cover;
            background-position: center;
            /* Ganti URL di bawah ini dengan path/URL gambar yang Anda lampirkan */
            background-image: url('asset/images/beranda.jpeg');
            min-height: calc(100vh - 64px);
        }

        .product-card,
        .country-card {
            background-color: #ffffff;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease-in-out;
            cursor: pointer;
            /* Menambahkan cursor pointer untuk card yang bisa diklik */
        }

        .product-card:hover,
        .country-card:hover {
            transform: translateY(-5px);
        }

        .product-card img,
        .country-card img {
            width: 100%;
            height: 128px;
            /* Tinggi produk card */
            object-fit: cover;
            border-bottom: 1px solid #eee;
        }

        /* Mengubah warna teks placeholder pada input */
        .header-search::placeholder {
            color: #a0aec0;
            opacity: 1;
        }

        .footer-logo {
            filter: brightness(0.6);
        }

        /* Style untuk ikon di header */
        .header-icon {
            color: #4a5568;
            transition: color 0.2s ease-in-out;
        }

        .header-icon:hover {
            color: #e53e3e;
        }

        /* Overlay untuk hero section */
        .hero-section .overlay-dark {
            background-color: rgba(0, 0, 0, 0.5);
        }

        /* Overlay untuk section produk best-seller */
        #produk-best-seller-section {
            background-color: #E0F2F7;
            padding: 3rem 0;
        }

        #produk-best-seller-section h2 {
            color: #2C3E50;
        }

        /* Overlay untuk section negara terpopuler */
        #negara-terpopuler-section {
            background-color: #F7FAFC;
            padding: 3rem 0;
        }

        #negara-terpopuler-section h2 {
            color: #1A202C;
        }

        /* Penyesuaian untuk teks "Apa itu TitipGo?" */
        .titipgo-description-section {
            background-color: #ffffff;
            color: #4a5568;
            padding: 2rem 1rem;
            text-align: center;
        }

        .titipgo-description-section h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1A202C;
        }

        .titipgo-description-section p {
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.7;
            font-size: 1rem;
            text-align: justify;
        }

        .titipgo-description-section img.logo-in-text {
            height: 2rem;
            margin: 0 0.5rem;
        }

        /* Kelas untuk menengahkan navigasi dan menambahkan jarak */
        /* Nav center ini tidak lagi digunakan untuk menengahkan secara global, tetapi untuk mengatur gap antara elemen nav */
        .nav-items-group {
            /* Kelas baru untuk menampung nav dan auth buttons */
            display: flex;
            align-items: center;
            gap: 1.5rem;
            /* Jarak antara Kategori dan Masuk */
        }

        .nav-items-group .nav-link {
            /* Style untuk link navigasi di dalam grup baru */
            font-weight: 600;
            color: #4a5568;
            transition: color 0.2s ease-in-out;
        }

        .nav-items-group .nav-link:hover {
            color: #e53e3e;
            /* Pink on hover */
        }


        .country-card {
            position: relative;
            background-color: #ffffff;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .country-card img {
            width: 100%;
            height: 160px;
            /* Tinggi negara card */
            object-fit: cover;
            display: block;
        }

        .country-card .country-name-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 0.5rem 0;
            text-align: center;
            font-weight: 600;
            font-size: 1.1rem;
        }

        /* === Updated CSS for Masuk/Daftar Buttons === */
        .auth-button-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .auth-button {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            text-decoration: none;
            transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out, color 0.2s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            height: 40px;
            min-width: 90px;
        }

        .auth-button.masuk {
            background-color: #2563eb;
            color: white;
            border: 1px solid #2563eb;
        }

        .auth-button.masuk:hover {
            background-color: #1d4ed8;
            border-color: #1d4ed8;
        }

        .auth-button.daftar {
            background-color: #ec4899;
            color: white;
            border: 1px solid #ec4899;
        }

        .auth-button.daftar:hover {
            background-color: #db2777;
            border-color: #db2777;
        }

        /* Style for user profile icon/name (hidden by default in this context) */
        .user-profile-menu {
            position: relative;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-profile-menu:hover .user-name {
            color: #e53e3e;
            /* Pink on hover */
        }
    </style>
</head>

<body class="font-sans bg-white text-gray-800">
    <header class="bg-white shadow-md py-1 px-6 flex justify-between items-center fixed w-full top-0 z-50 mb-8">
        <div class="flex items-center space-x-3">
            <img src="asset/images/titipgo_logo_remove.png" alt="Logo TitipGo" class="w-28 sm:w-32">
            <div class="relative hidden md:block">
                <input type="text" placeholder="Cari Barang..."
                    class="header-search pl-10 pr-4 py-2 border border-gray-300 rounded-full w-56 lg:w-64 focus:outline-none focus:border-pink-500">
                <svg class="w-5 h-5 absolute left-2.5 top-2.5 text-gray-500 pointer-events-none" fill="currentColor"
                    viewBox="0 0 20 20">
                    <path
                        d="M8 4a4 4 0 104 4 4 4 0 00-4-4zM2 8a6 6 0 1110.39 3.94l4.3 4.3-1.42 1.42-4.3-4.3A6 6 0 012 8z" />
                </svg>
            </div>
        </div>

        <!-- Grup baru untuk navigasi dan tombol autentikasi -->
        <div class="flex items-center space-x-4 sm:space-x-6">
            <nav class="nav-items-group hidden md:flex items-center gap-6">
                <a href="pembeli_dashboard.html" class="nav-link">Beranda</a>
                <div class="dropdown-kategori relative inline-block">
                    <!-- Link Kategori sekarang langsung ke pembeli_kategori.html -->
                    <a href="pembeli_kategori.html" id="kategoriMenu" class="nav-link">Kategori</a>
                    <div class="dropdown-content absolute left-0 top-full bg-white shadow-lg rounded min-w-[160px] z-10 py-2 border border-gray-200"
                        id="dropdownKategori" style="display:none;">
                        <!-- Opsi 'Produk' telah dihapus -->
                        <a href="pembeli_kategori.html"
                            class="block px-6 py-2 text-gray-900 no-underline text-sm hover:bg-gray-100 hover:text-pink-600">Pilih
                            Kategori</a>
                    </div>
                </div>
            </nav>

            <!-- Authentication buttons - ALWAYS VISIBLE IN PRE-LOGIN STATE -->
            <div id="authContainer" class="auth-button-container">
                <a href="login_user.html" class="auth-button masuk">Masuk</a>
                <a href="daftar_login.html" class="auth-button daftar">Daftar</a>
            </div>

            <!-- User profile (HIDDEN by default, shown via JS after login on other pages if implemented) -->
            <div id="userProfileContainer" class="hidden user-profile-menu">
                <img id="userAvatar" src="asset/images/default_avatar.png" alt="User Avatar"
                    class="w-10 h-10 rounded-full object-cover border-2 border-pink-500">
                <span id="userName"
                    class="user-name font-semibold text-gray-700 hover:text-pink-600 hidden md:inline-block"></span>
                <i class="fas fa-chevron-down text-gray-500 text-xs ml-1"></i>

                <div id="userDropdown"
                    class="hidden absolute right-0 top-[60px] bg-white shadow-lg rounded min-w-[160px] z-[1001] py-2 border border-gray-200">
                    <a href="pembeli_akun.html"
                        class="block px-5 py-3 text-gray-900 no-underline text-sm border-b border-gray-100 hover:bg-gray-100 hover:text-pink-600">Akun
                        Saya</a>
                    <a href="pembeli_pesanan_saya.html"
                        class="block px-5 py-3 text-gray-900 no-underline text-sm border-b border-gray-100 hover:bg-gray-100 hover:text-pink-600">Pesanan</a>
                    <a href="jastiper_dashboard.html"
                        class="block px-5 py-3 text-gray-700 no-underline text-sm border-b border-gray-100 hover:bg-gray-100 hover:text-pink-600"
                        id="tokoSayaLink">Toko Saya</a>
                    <a href="#" onclick="openChatCS();return false;"
                        class="block px-5 py-3 text-gray-700 no-underline text-sm border-b border-gray-100 hover:bg-gray-100 hover:text-pink-600">Chat
                        dengan CS</a>
                    <a href="#" onclick="logoutUser();return false;"
                        class="block px-5 py-3 text-red-600 no-underline text-sm hover:bg-gray-100">Logout</a>
                </div>
            </div>
        </div>
    </header>

    <main class="pt-16">
        <!-- Adjust pt-16 to clear fixed header -->
        <section id="hero-section"
            class="relative h-[80vh] flex items-center justify-center text-center px-4 hero-section">
            <div class="absolute inset-0 overlay-dark z-0"></div>
            <div class="relative z-10 text-white p-4">
                <h1 class="text-4xl md:text-5xl font-bold mb-4">Travel Anywhere, Shop Everywhere</h1>
                <p class="text-lg md:text-xl max-w-2xl mx-auto">Solusi mudah untuk kamu yang mau belanja dari luar
                    negeri
                    dengan mudah dan aman</p>
            </div>
        </section>

        <section class="titipgo-description-section text-center">
            <h2>
                Apa itu
                <img src="asset/images/titipgo_logo_remove.png" alt="Logo TitipGo" class="logo-in-text">
                Itu?
            </h2>
            <p class="text-base">
                Aplikasi TitipGo membantu kamu menemukan produk luar negeri yang kamu mau, tanpa ribet dan bisa
                langsung diantar oleh Jastiper terpercaya. Gabung dan nikmati pengalaman belanja dari berbagai negara
                hanya dalam satu aplikasi. Platform digital terbaik untuk mendukung bisnis untuk menemukan penemuan baru
                dari
                barang-barang produk unggulan. Kami siap mengantarkan Anda kemana pun Anda inginkan! TitipGo adalah
                aplikasi revolusioner yang dirancang untuk mengubah cara Anda berbelanja dari luar negeri. Dengan
                TitipGo,
                Anda dapat menemukan dan membeli produk-produk unik dari berbagai negara dengan mudah dan aman. Apakah
                Anda
                mencari fashion terbaru dari Paris, gadget inovatif dari Tokyo, atau kerajinan tangan otentik dari Bali,
                TitipGo memiliki semuanya. Kami menghubungkan Anda dengan jastiper terpercaya yang siap membantu Anda
                mendapatkan barang impian Anda tanpa kerumitan. Dengan TitipGo, belanja internasional jadi lebih mudah,
                terjangkau, dan bertanggung jawab. Kami percaya bahwa setiap orang berhak memiliki akses ke
                produk-produk
                berkualitas dari seluruh dunia, dan kami hadir untuk mewujudkannya. Titip Barang Jadi Mudah, Cari
                Jastiper
                Bawa Oleh-Oleh.
            </p>
        </section>

        <section id="produk-best-seller-section" class="relative py-12 text-center">
            <div class="relative z-10 p-4">
                <h2 class="text-3xl font-bold mb-10">Produk</h2>
                <div id="produk-best-seller"
                    class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-6 px-4 max-w-6xl mx-auto">
                    <p id="loadingProducts" class="col-span-full text-center text-gray-500">Memuat produk...</p>
                    <p id="errorProducts" class="col-span-full text-center text-red-500 hidden">Gagal memuat produk.
                        Silakan coba lagi nanti.</p>
                    <!-- Produk akan dimuat di sini oleh JavaScript -->
                </div>
                <button onclick="window.location.href='pembeli_kategori.html'"
                    class="mt-10 bg-white text-blue-800 font-bold px-8 py-3 rounded-lg hover:bg-gray-100 transition-colors shadow-md">
                    Lihat Semua
                </button>
            </div>
        </section>

        <section id="negara-terpopuler-section" class="py-10 text-center">
            <h2 class="text-3xl font-bold text-gray-900 mb-10">Negara</h2>
            <div id="negara-terpopuler"
                class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-6 px-4 max-w-6xl mx-auto">
                <p id="loadingCountries" class="col-span-full text-center text-gray-500">Memuat negara...</p>
                <p id="errorCountries" class="col-span-full text-center text-red-500 hidden">Gagal memuat negara.
                    Silakan coba lagi nanti.</p>
                <!-- Negara akan dimuat di sini oleh JavaScript -->
            </div>
            <button onclick="window.location.href='pembeli_kategori.html'"
                class="mt-10 bg-gray-900 text-white font-bold px-8 py-3 rounded-lg hover:bg-gray-700 transition-colors shadow-md">
                Lihat Semua
            </button>
        </section>
    </main>

    <footer class="bg-gray-200 text-gray-700 py-8 text-sm">
        <div class="max-w-6xl mx-auto px-4 flex flex-col md:flex-row justify-between items-start md:items-center">
            <div class="mb-6 md:mb-0 text-left">
                <p class="font-bold text-gray-800 mb-2">INFORMASI</p>
                <a href="#" class="block hover:text-pink-600 mb-1">Tentang Kami</a>
                <a href="#" class="block hover:text-pink-600 mb-1">Pertanyaan Umum</a>
                <a href="#" class="block hover:text-pink-600">Hubungi Kami</a>
            </div>
            <div class="text-center mb-6 md:mb-0">
                <img src="asset/images/titipgo_logo_remove.png" alt="Logo TitipGo"
                    class="mx-auto w-32 mb-2 footer-logo">
                <p class="text-xs text-gray-600">Aman, Nyata, Amanah</p>
            </div>
            <div class="text-left md:text-right">
                <p class="font-bold text-gray-800 mb-2">IKUTI SOSIAL MEDIA KAMI</p>
                <a href="#" class="flex items-center justify-start md:justify-end hover:text-pink-600 mb-1">
                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                        <path
                            d="M22.675 0H1.325C.593 0 0 .593 0 1.325v21.35C0 23.407.593 24 1.325 24h11.493v-9.294H9.692V11.23h3.155V8.2c0-3.136 1.91-4.847 4.704-4.847 1.336 0 2.607.238 2.95.34v3.218h-1.921c-1.505 0-1.795.716-1.795 1.76V11.23h3.587l-.467 3.476h-3.12V24h6.115c.732 0 1.325-.593 1.325-1.325V1.325C24 .593 23.407 0 22.675 0z" />
                    </svg>
                    Facebook
                </a>
                <a href="#" class="flex items-center justify-start md:justify-end hover:text-pink-600 mb-1">
                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                        <path
                            d="M21.581 6.184a2.953 2.953 0 00-2.122-2.122C17.388 3 12 3 12 3s-5.388 0-7.459 1.062a2.953 2.953 0 00-2.122 2.122C0 8.012 0 12 0 12s0 3.988 1.062 6.059a2.953 2.953 0 002.122 2.122C4.612 21 12 21 12 21s5.388 0 7.459-1.062a2.953 2.953 0 002.122-2.122C24 15.988 24 12 24 12s0-3.988-1.062-6.059zM9.545 15.545V8.455L15.545 12l-6 3.545z" />
                    </svg>
                    Youtube
                </a>
                <a href="#" class="flex items-center justify-start md:justify-end hover:text-pink-600">
                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                        <path
                            d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.772 1.667 4.979 4.979.058 1.265.07 1.645.07 4.85s-.012 3.584-.07 4.85c-.148 3.252-1.667 4.772-4.979 4.979-1.265.058-1.645.07-4.85.07s-3.584-.012-4.85-.07c-3.252-.148-4.772-1.667-4.979-4.979-.058-1.265-.07-1.645-.07-4.85s.012-3.584.07-4.85c.148-3.252 1.667-4.772 4.979-4.979 1.265-.058 1.645-.07 4.85-.07zm0-2.163C8.756 0 8.356.014 7.037.069 3.543.225 1.777 1.99 1.621 5.485.066 6.804.052 7.204.052 10.518s.014 3.314.069 4.633c.156 3.495 1.922 5.26 5.417 5.417 1.319.055 1.719.069 5.033.069s3.314-.014 4.633-.069c3.495-.156 5.26-1.922 5.417-5.417.055-1.319.069-1.719.069-5.033s-.014-3.314-.069-4.633c-.156-3.495-1.922-5.26-5.417-5.417-1.319-.055-1.719-.069-5.033-.069zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.5-11.5a1.5 1.5 0 100 3 1.5 1.5 0 000-3z" />
                    </svg>
                    Instagram
                </a>
            </div>
        </div>
    </footer>
    <div id="chatCSModal"
        style="display:none;position:fixed;z-index:1000;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.18);align-items:center;justify-content:center;">
        <div
            style="background:#fff;border-radius:12px;max-width:400px;width:90vw;padding:0 0 16px 0;box-shadow:0 4px 24px rgba(0,0,0,0.12);margin:auto;">
            <div
                style="display:flex;align-items:center;justify-content:space-between;padding:16px 20px 12px 20px;border-bottom:1px solid #eee;">
                <span style="font-weight:bold;font-size:17px;">Chat dengan CS</span>
                <button onclick="document.getElementById('chatCSModal').style.display='none'"
                    style="background:none;border:none;font-size:22px;cursor:pointer;">&times;</button>
            </div>
            <div style="padding:18px 20px 0 20px;min-height:80px;">
                <div id="chatCSMessages" style="font-size:15px;color:#444;min-height:40px;"></div>
            </div>
            <div style="display:flex;align-items:center;padding:10px 20px 0 20px;gap:8px;">
                <input id="chatCSInput" type="text" placeholder="Tulis pesan..."
                    style="flex:1;padding:8px 12px;border-radius:6px;border:1px solid #ccc;font-size:15px;">
                <button onclick="sendCSMessage()"
                    style="background:#1976d2;color:#fff;border:none;padding:8px 18px;border-radius:6px;font-weight:bold;cursor:pointer;">Kirim</button>
            </div>
        </div>
    </div>
    <script type="module">
        // Import db dan fungsi-fungsi Firestore dari firebase-config.js
        import { db, collection, getDocs } from "./js/firebase-config.js";

        // --- PENGATURAN SLIDER HERO SECTION ---
        const heroImages = [
            'asset/images/beranda.jpeg',
            'asset/images/Bg_beranda2.jpeg'
            // Tambahkan gambar lain jika ada
        ];

        let currentHeroImageIndex = 0;
        const heroSection = document.getElementById('hero-section');

        function changeHeroImage() {
            currentHeroImageIndex = (currentHeroImageIndex + 1) % heroImages.length;
            const nextImageUrl = heroImages[currentHeroImageIndex];
            heroSection.style.backgroundImage = `url('${nextImageUrl}')`;
        }

        setInterval(changeHeroImage, 5000); // Aktifkan slider gambar otomatis

        // --- FUNGSI DROPDOWN KATEGORI ---
        const kategoriMenu = document.getElementById('kategoriMenu');
        const dropdownKategori = document.getElementById('dropdownKategori');

        kategoriMenu.addEventListener('click', function (event) {
            // Jika dropdown hanya berisi satu item yang sama dengan link utama,
            // maka kita bisa mencegah default dan langsung navigasi.
            // Namun, karena ada kemungkinan dropdown akan berisi lebih banyak item di masa depan,
            // kita biarkan perilaku default link dan dropdown terbuka.
            // Jika Anda ingin klik Kategori langsung navigasi tanpa membuka dropdown,
            // Anda bisa menambahkan event.preventDefault() di sini dan window.location.href.
            // Untuk saat ini, link sudah mengarah ke pembeli_kategori.html, jadi tidak perlu perubahan di sini.
            // Cukup tampilkan/sembunyikan dropdown seperti biasa.
            dropdownKategori.style.display = dropdownKategori.style.display === 'block' ? 'none' : 'block';
        });

        document.addEventListener('click', function (event) {
            if (!kategoriMenu.contains(event.target) && !dropdownKategori.contains(event.target)) {
                dropdownKategori.style.display = 'none';
            }
        });

        // --- FUNGSI CHAT CS (tidak memerlukan login) ---
        function openChatCS() {
            document.getElementById('chatCSModal').style.display = 'flex';
            document.getElementById('chatCSMessages').innerHTML = "Halo! Ada yang bisa kami bantu?"; // Pesan awal
            document.getElementById('chatCSInput').value = ''; // Kosongkan input
        }

        function sendCSMessage() {
            const chatInput = document.getElementById('chatCSInput');
            const chatMessages = document.getElementById('chatCSMessages');
            const message = chatInput.value.trim();

            if (message !== '') {
                chatMessages.innerHTML += `<p><strong>Anda:</strong> ${message}</p>`;
                chatInput.value = '';

                setTimeout(() => {
                    chatMessages.innerHTML += `<p><strong>CS:</strong> Terima kasih atas pesan Anda. Kami akan segera merespon.</p>`;
                    chatMessages.scrollTop = chatMessages.scrollHeight; // Gulir ke bawah
                }, 1000);
            }
        }

        // --- FUNGSI UNTUK MEMUAT PRODUK DARI FIRESTORE ---
        async function loadProducts() {
            const produkContainer = document.getElementById('produk-best-seller');
            const loadingMessage = document.getElementById('loadingProducts');
            const errorMessage = document.getElementById('errorProducts');

            produkContainer.innerHTML = ''; // Kosongkan konten sebelumnya
            loadingMessage.classList.remove('hidden'); // Tampilkan pesan loading
            errorMessage.classList.add('hidden'); // Sembunyikan pesan error

            try {
                // Menggunakan fungsi collection() dari Modular SDK
                const productsCollectionRef = collection(db, "produk");
                const snapshot = await getDocs(productsCollectionRef); // Menggunakan getDocs() dari Modular SDK

                if (snapshot.empty) {
                    produkContainer.innerHTML = '<p class="col-span-full text-center text-gray-600">Belum ada produk yang tersedia.</p>';
                    loadingMessage.classList.add('hidden');
                    return;
                }

                // Ambil hingga 8 produk teratas
                const productsToDisplay = snapshot.docs.slice(0, 8);

                productsToDisplay.forEach(doc => {
                    const product = doc.data();
                    const productCard = `
                        <a href="pembeli_detail_produk.html?id=${doc.id}" class="product-card text-black rounded-lg overflow-hidden shadow-md p-3">
                            <img src="${product.imageUrl || 'asset/images/default_product.jpeg'}" alt="Produk ${product.namaBarang}"
                                class="w-full h-32 object-cover rounded mb-2">
                            <p class="font-semibold text-lg">${product.namaBarang}</p>
                            <span class="text-sm text-gray-500">${product.negara || 'Negara Asal'}</span>
                        </a>
                    `;
                    produkContainer.innerHTML += productCard;
                });
                loadingMessage.classList.add('hidden'); // Sembunyikan pesan loading setelah data dimuat

            } catch (error) {
                console.error("Error fetching products: ", error);
                loadingMessage.classList.add('hidden');
                errorMessage.classList.remove('hidden'); // Tampilkan pesan error
                errorMessage.textContent = `Gagal memuat produk: ${error.message}. Silakan cek konsol browser untuk detail.`;
            }
        }

        // --- FUNGSI UNTUK MEMUAT NEGARA DARI FIRESTORE (dari koleksi produk) ---
        async function loadCountries() {
            const negaraContainer = document.getElementById('negara-terpopuler');
            const loadingMessage = document.getElementById('loadingCountries');
            const errorMessage = document.getElementById('errorCountries');

            negaraContainer.innerHTML = ''; // Kosongkan konten sebelumnya
            loadingMessage.classList.remove('hidden'); // Tampilkan pesan loading
            errorMessage.classList.add('hidden'); // Sembunyikan pesan error

            try {
                // Menggunakan fungsi collection() dari Modular SDK
                const productsCollectionRef = collection(db, "produk");
                const snapshot = await getDocs(productsCollectionRef); // Menggunakan getDocs() dari Modular SDK

                const countries = new Set();
                snapshot.forEach(doc => {
                    const product = doc.data();
                    if (product.negara && product.negara.trim() !== '') {
                        countries.add(product.negara.trim());
                    }
                });

                if (countries.size === 0) {
                    negaraContainer.innerHTML = '<p class="col-span-full text-center text-gray-600">Belum ada negara yang tersedia.</p>';
                    loadingMessage.classList.add('hidden');
                    return;
                }

                const sortedCountries = Array.from(countries).sort();
                const countriesToDisplay = sortedCountries.slice(0, 10); // Ambil hingga 10 negara teratas

                countriesToDisplay.forEach(countryName => {
                    const countryFlagFileName = countryName.toLowerCase().replace(/\s/g, '_').replace(/[^a-z0-9_]/g, '');
                    const countryImageUrl = `asset/images/flag_${countryFlagFileName}.jpeg`;
                    const fallbackImageUrl = 'asset/images/default_country.jpeg';

                    const countryCard = `
                        <div class="country-card" onclick="window.location.href='pembeli_kategori.html?negara=${encodeURIComponent(countryName)}'">
                            <img src="${countryImageUrl}" alt="Bendera ${countryName}" onerror="this.onerror=null;this.src='${fallbackImageUrl}';">
                            <div class="country-name-overlay">${countryName}</div>
                        </div>
                    `;
                    negaraContainer.innerHTML += countryCard;
                });
                loadingMessage.classList.add('hidden');

            } catch (error) {
                console.error("Error fetching countries: ", error);
                loadingMessage.classList.add('hidden');
                errorMessage.classList.remove('hidden');
                errorMessage.textContent = `Gagal memuat negara: ${error.message}. Silakan cek konsol browser untuk detail.`;
            }
        }

        // Expose functions to global scope for onclick attributes
        window.openChatCS = openChatCS;
        window.sendCSMessage = sendCSMessage;

        // Panggil fungsi untuk memuat data saat DOMContentLoaded
        document.addEventListener('DOMContentLoaded', () => {
            loadProducts();
            loadCountries();
        });

    </script>
</body>

</html>