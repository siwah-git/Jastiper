<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Detail Laporan - Laporan Penjualan Juli 2025 - TitipGo Admin</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>

    <style>
      /* Custom styles */
      :root {
        --sidebar-width: 268px; /* Pastikan nilai ini sesuai dengan lebar aktual sidebar Anda */
      }

      .sidebar {
        width: var(--sidebar-width);
      }

      .main-content {
        margin-left: var(--sidebar-width);
        flex-grow: 1;
      }

      body {
        min-height: 100vh;
        background-image: url("asset/images/background.png"); /* Add your background image */
        background-size: cover;
        background-position: center;
        background-attachment: fixed; /* Make background fixed */
        background-repeat: no-repeat;
      }

      /* Untuk membatasi lebar konten utama agar tidak terlalu lebar di layar besar */
      .content-wrapper {
        max-width: 1000px; /* Sedikit lebih lebar untuk laporan yang mungkin berisi grafik/tabel */
        margin-left: auto;
        margin-right: auto;
      }

      /* Style untuk badge status (jika laporan memiliki status tertentu, misal Draft/Final) */
      .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 9999px; /* Full rounded */
        font-weight: 600; /* Semibold */
        font-size: 0.75rem; /* text-xs */
        line-height: 1rem;
        display: inline-block;
      }

      .status-final {
        background-color: #d1fae5; /* green-100 */
        color: #065f46; /* green-800 */
      }
      .status-draft {
        background-color: #fefcbf; /* yellow-100 */
        color: #92400e; /* yellow-800 */
      }
      .status-archived {
        background-color: #e2e8f0; /* gray-200 */
        color: #4b5563; /* gray-700 */
      }
    </style>
  </head>
  <body class="flex min-h-screen bg-gray-100">
    <aside
      class="sidebar bg-white text-gray-800 flex flex-col justify-between shadow-lg fixed top-0 left-0 h-screen z-50"
    >
      <div>
        <nav class="space-y-2 p-4">
          <img
            src="asset/images/logosiwah.png"
            alt="Logo"
            class="w-48 h-20 object-contain mb-4"
          />

          <a
            href="admin-dashboard.html"
            class="sidebar-item flex items-center py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition duration-200 ease-in-out"
          >
            <i class="fas fa-home mr-3 text-lg"></i> Dashboard
          </a>
          <a
            href="admin-katalog.html"
            class="sidebar-item flex items-center py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition duration-200 ease-in-out"
          >
            <i class="fas fa-box mr-3 text-lg"></i> Manajemen Katalog
          </a>
          <a
            href="admin-pengguna.html"
            class="sidebar-item flex items-center py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition duration-200 ease-in-out"
          >
            <i class="fas fa-users mr-3 text-lg"></i> Manajemen Pengguna
          </a>
          <a
            href="admin-toko.html"
            class="sidebar-item block py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition"
          >
            <i class="fas fa-store mr-3"></i> Manajemen Toko
          </a>
          <a
            href="admin-pesanan.html"
            class="sidebar-item flex items-center py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition duration-200 ease-in-out"
          >
            <i class="fas fa-shopping-cart mr-3 text-lg"></i> Manajemen Pesanan
          </a>
          <a
            href="admin-aduan.html"
            class="sidebar-item flex items-center py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition duration-200 ease-in-out"
          >
            <i class="fas fa-envelope mr-3 text-lg"></i> Aduan
          </a>
          <a
            href="admin-laporan.html"
            class="sidebar-item flex items-center py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition duration-200 ease-in-out"
          >
            <i class="fas fa-chart-line mr-3 text-lg"></i> Laporan
          </a>
          <a
            href="admin-pendapatan.html"
            class="sidebar-item flex items-center py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition duration-200 ease-in-out"
          >
            <i class="fas fa-money-bill-wave mr-3 text-lg"></i> Pendapatan
          </a>
          <a
            href="admin-profil.html"
            class="sidebar-item flex items-center py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition duration-200 ease-in-out"
          >
            <i class="fas fa-user-circle mr-3 text-lg"></i> Profil
          </a>
          <a
            href="admin-about-us.html"
            class="sidebar-item flex items-center py-2 px-4 rounded-md text-gray-700 hover:bg-pink-100 hover:text-pink-600 transition duration-200 ease-in-out"
          >
            <i class="fas fa-info-circle mr-3 text-lg"></i> Tentang Kami
          </a>
        </nav>
      </div>
      <footer class="text-sm text-gray-500 text-center p-4 border-t">
        &copy; 2025 TitipGo. All rights reserved.
      </footer>
    </aside>

    <main class="main-content p-8 overflow-y-auto">
      <header
        class="flex items-center justify-between bg-blue-600 text-white p-4 rounded-lg shadow-md mb-8"
      >
        <div class="flex items-center">
          <a
            href="admin-dashboard.html"
            class="text-white hover:text-blue-100 mr-4"
          >
            <i class="fas fa-arrow-left text-2xl"></i>
          </a>
          <h1 class="text-2xl font-bold">Detail Laporan</h1>
        </div>
        <div class="flex items-center space-x-4">
          <button
            class="bg-blue-700 hover:bg-blue-800 text-white font-semibold py-2 px-4 rounded-md shadow-sm transition duration-200 ease-in-out flex items-center text-sm"
          >
            <i class="fas fa-file-pdf mr-2"></i> Ekspor PDF
          </button>
          <button
            class="bg-teal-600 hover:bg-teal-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm transition duration-200 ease-in-out flex items-center text-sm"
          >
            <i class="fas fa-file-excel mr-2"></i> Ekspor Excel
          </button>
          <a
            href="#"
            class="text-white hover:text-blue-100 transition duration-200 ease-in-out px-4 py-2 rounded-md border border-blue-400 hover:bg-blue-700 text-sm flex items-center"
          >
            <i class="fas fa-sign-out-alt mr-2"></i> Logout
          </a>
        </div>
      </header>
      <div class="content-wrapper">
        <nav class="text-sm text-gray-600 mb-6">
          <ol class="list-none p-0 inline-flex">
            <li class="flex items-center">
              <a
                href="admin-dashboard.html"
                class="text-blue-600 hover:text-blue-800"
                >Dashboard</a
              >
              <i class="fas fa-chevron-right mx-2 text-xs"></i>
            </li>
            <li class="flex items-center">
              <a
                href="admin-laporan.html"
                class="text-blue-600 hover:text-blue-800"
                >Laporan</a
              >
              <i class="fas fa-chevron-right mx-2 text-xs"></i>
            </li>
            <li class="flex items-center text-gray-500">Penjualan Juli 2025</li>
          </ol>
        </nav>

        <div class="flex flex-col space-y-6">
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3
              class="text-xl font-semibold text-gray-800 mb-4 flex items-center"
            >
              <i class="fas fa-clipboard-list text-purple-500 mr-2"></i>
              Informasi Laporan
            </h3>
            <div
              class="grid grid-cols-1 sm:grid-cols-2 gap-y-3 gap-x-6 text-gray-700 text-sm"
            >
              <p>
                <strong>Nama Laporan:</strong>
                <span id="report-name">Memuat...</span>
              </p>
              <p>
                <strong>ID Laporan:</strong>
                <span id="report-id">Memuat...</span>
              </p>
              <p>
                <strong>Periode:</strong>
                <span id="report-period">Memuat...</span>
              </p>
              <p>
                <strong>Tanggal Dibuat:</strong>
                <span id="report-created-date">Memuat...</span>
              </p>
              <p>
                <strong>Dibuat Oleh:</strong>
                <span id="report-author">Memuat...</span>
              </p>
              <p>
                <strong>Status:</strong>
                <span id="laporan-status-badge" class="status-badge"
                  >Memuat...</span
                >
              </p>
            </div>
          </div>

          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3
              class="text-xl font-semibold text-gray-800 mb-4 flex items-center"
            >
              <i class="fas fa-chart-bar text-red-500 mr-2"></i> Ringkasan
              Kinerja
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
              <div
                class="bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200"
              >
                <p class="text-sm text-gray-600">Total Penjualan</p>
                <p
                  class="text-2xl font-bold text-green-600 mt-1"
                  id="total-sales"
                >
                  Memuat...
                </p>
              </div>
              <div
                class="bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200"
              >
                <p class="text-sm text-gray-600">Jumlah Pesanan</p>
                <p
                  class="text-2xl font-bold text-blue-600 mt-1"
                  id="total-orders"
                >
                  Memuat...
                </p>
              </div>
              <div
                class="bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200"
              >
                <p class="text-sm text-gray-600">Jastiper Aktif</p>
                <p
                  class="text-2xl font-bold text-purple-600 mt-1"
                  id="active-jastipers"
                >
                  Memuat...
                </p>
              </div>
              <div
                class="bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200"
              >
                <p class="text-sm text-gray-600">Pelanggan Baru</p>
                <p
                  class="text-2xl font-bold text-indigo-600 mt-1"
                  id="new-customers"
                >
                  Memuat...
                </p>
              </div>
              <div
                class="bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200"
              >
                <p class="text-sm text-gray-600">Produk Terjual</p>
                <p
                  class="text-2xl font-bold text-yellow-600 mt-1"
                  id="products-sold"
                >
                  Memuat...
                </p>
              </div>
              <div
                class="bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200"
              >
                <p class="text-sm text-gray-600">Rata-rata Nilai Pesanan</p>
                <p
                  class="text-2xl font-bold text-orange-600 mt-1"
                  id="avg-order-value"
                >
                  Memuat...
                </p>
              </div>
            </div>
          </div>

          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3
              class="text-xl font-semibold text-gray-800 mb-4 flex items-center"
            >
              <i class="fas fa-chart-pie text-cyan-500 mr-2"></i> Visualisasi
              Data
            </h3>
            <div class="flex flex-col md:flex-row gap-6">
              <div class="md:w-1/2">
                <h4 class="font-semibold text-gray-700 mb-2">
                  Penjualan Harian
                </h4>
                <canvas id="dailySalesChart" class="w-full"></canvas>
              </div>
              <div class="md:w-1/2">
                <h4 class="font-semibold text-gray-700 mb-2">
                  Penjualan per Kategori Produk
                </h4>
                <canvas id="categorySalesChart" class="w-full"></canvas>
              </div>
            </div>
          </div>

          <div class="bg-white p-6 rounded-lg shadow-md overflow-x-auto">
            <h3
              class="text-xl font-semibold text-gray-800 mb-4 flex items-center"
            >
              <i class="fas fa-table text-indigo-500 mr-2"></i> Data Penjualan
              Rinci
            </h3>
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th
                    scope="col"
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Tanggal
                  </th>
                  <th
                    scope="col"
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    ID Pesanan
                  </th>
                  <th
                    scope="col"
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Produk
                  </th>
                  <th
                    scope="col"
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Jastiper
                  </th>
                  <th
                    scope="col"
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Total
                  </th>
                </tr>
              </thead>
              <tbody
                class="bg-white divide-y divide-gray-200"
                id="sales-detail-table-body"
              ></tbody>
            </table>
            <div class="mt-4 text-right">
              <a href="#" class="text-blue-600 hover:underline text-sm"
                >Lihat Semua Data Penjualan &raquo;</a
              >
            </div>
          </div>

          <div class="bg-white p-6 rounded-lg shadow-md">
            <h3
              class="text-xl font-semibold text-gray-800 mb-4 flex items-center"
            >
              <i class="fas fa-lightbulb text-yellow-500 mr-2"></i> Analisis &
              Kesimpulan
            </h3>
            <p
              class="text-gray-700 text-sm leading-relaxed"
              id="report-analysis"
            >
              Memuat...
            </p>
          </div>
        </div>
      </div>
    </main>

    <script>
      // Your Firebase configuration
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_STORAGE_BUCKET",
        messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
        appId: "YOUR_APP_ID",
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      document.addEventListener("DOMContentLoaded", function () {
        // Skrip untuk menyorot navigasi sidebar
        const currentPath = window.location.pathname.split("/").pop();
        const sidebarLinks = document.querySelectorAll(".sidebar-item");

        sidebarLinks.forEach((link) => {
          const linkHref = link.getAttribute("href");
          const linkFileName = linkHref.split("/").pop();

          let isLinkActive = false;

          // Special handling for detail pages: highlight parent menu
          if (
            linkFileName === "admin-laporan.html" &&
            currentPath.startsWith("admin-laporan-detail")
          ) {
            isLinkActive = true;
          } else if (linkFileName === currentPath) {
            isLinkActive = true;
          } else if (
            (currentPath === "" || currentPath === "index.html") &&
            linkFileName === "admin-dashboard.html"
          ) {
            isLinkActive = true;
          }

          if (isLinkActive) {
            link.classList.remove(
              "text-gray-700",
              "hover:bg-pink-100",
              "hover:text-pink-600",
              "transition",
              "duration-200",
              "ease-in-out"
            );
            link.classList.add("bg-pink-600", "text-white", "font-semibold");
          } else {
            link.classList.remove("bg-pink-600", "text-white", "font-semibold");
            link.classList.add(
              "text-gray-700",
              "hover:bg-pink-100",
              "hover:text-pink-600",
              "transition",
              "duration-200",
              "ease-in-out"
            );
          }
        });

        // Function to format currency
        const formatCurrency = (amount) => {
          return new Intl.NumberFormat("id-ID", {
            style: "currency",
            currency: "IDR",
            minimumFractionDigits: 0,
          }).format(amount);
        };

        // Function to update report status badge
        const updateStatusBadge = (status) => {
          const statusBadge = document.getElementById("laporan-status-badge");
          if (statusBadge) {
            statusBadge.className = "status-badge"; // Reset classes
            switch (status) {
              case "final":
                statusBadge.classList.add("status-final");
                statusBadge.textContent = "Final";
                break;
              case "draft":
                statusBadge.classList.add("status-draft");
                statusBadge.textContent = "Draf";
                break;
              case "archived":
                statusBadge.classList.add("status-archived");
                statusBadge.textContent = "Diarsipkan";
                break;
              default:
                statusBadge.classList.add("bg-gray-200", "text-gray-800");
                statusBadge.textContent = "Tidak Diketahui";
                break;
            }
          }
        };

        // --- Firebase Data Fetching ---

        // Fetch Report Information
        const fetchReportInfo = async () => {
          try {
            const reportId =
              new URLSearchParams(window.location.search).get("id") ||
              "LPJ-202507"; // Get report ID from URL or default
            const docRef = db.collection("reports").doc(reportId);
            const doc = await docRef.get();

            if (doc.exists) {
              const data = doc.data();
              document.getElementById("report-name").textContent =
                data.name || "N/A";
              document.getElementById("report-id").textContent =
                data.id || "N/A";
              document.getElementById("report-period").textContent =
                data.period || "N/A";
              document.getElementById("report-created-date").textContent =
                data.createdDate || "N/A";
              document.getElementById("report-author").textContent =
                data.author || "N/A";
              updateStatusBadge(data.status);
              document.getElementById("report-analysis").textContent =
                data.analysis || "Tidak ada analisis tersedia.";
            } else {
              console.log("No such report document!");
              document.getElementById("report-name").textContent =
                "Data tidak ditemukan";
              // Set other fields to N/A or appropriate message
            }
          } catch (error) {
            console.error("Error fetching report information: ", error);
            alert("Error loading report information: " + error.message);
          }
        };

        // Fetch Summary Performance Data
        const fetchSummaryPerformance = async () => {
          try {
            // This part would ideally aggregate data from your 'orders' collection
            // For demonstration, let's assume a 'summary' document in 'reports' or a separate 'metrics' collection
            const summaryRef = db
              .collection("metrics")
              .doc("july_2025_sales_summary"); // Example path
            const doc = await summaryRef.get();

            if (doc.exists) {
              const data = doc.data();
              document.getElementById("total-sales").textContent =
                formatCurrency(data.totalSales || 0);
              document.getElementById("total-orders").textContent = (
                data.totalOrders || 0
              ).toLocaleString("id-ID");
              document.getElementById("active-jastipers").textContent = (
                data.activeJastipers || 0
              ).toLocaleString("id-ID");
              document.getElementById("new-customers").textContent = (
                data.newCustomers || 0
              ).toLocaleString("id-ID");
              document.getElementById("products-sold").textContent = (
                data.productsSold || 0
              ).toLocaleString("id-ID");
              document.getElementById("avg-order-value").textContent =
                formatCurrency(data.avgOrderValue || 0);
            } else {
              console.log("No summary performance data found!");
              document.getElementById("total-sales").textContent = "N/A";
              // Set other summary fields to N/A
            }
          } catch (error) {
            console.error("Error fetching summary performance: ", error);
            alert("Error loading summary performance: " + error.message);
          }
        };

        // Fetch Detailed Sales Data for Table
        const fetchDetailedSales = async () => {
          try {
            const salesTableBody = document.getElementById(
              "sales-detail-table-body"
            );
            salesTableBody.innerHTML =
              '<tr><td colspan="5" class="text-center py-4 text-gray-500">Memuat data...</td></tr>';

            // Fetch orders for July 2025 (adjust query as per your data structure)
            const ordersSnapshot = await db
              .collection("orders")
              .where("orderDate", ">=", "2025-07-01")
              .where("orderDate", "<=", "2025-07-31")
              .orderBy("orderDate", "desc")
              .limit(10) // Limit for initial display
              .get();

            salesTableBody.innerHTML = ""; // Clear loading message

            if (ordersSnapshot.empty) {
              salesTableBody.innerHTML =
                '<tr><td colspan="5" class="text-center py-4 text-gray-500">Tidak ada data penjualan untuk periode ini.</td></tr>';
              return;
            }

            ordersSnapshot.forEach((doc) => {
              const order = doc.data();
              const row = `
       <tr>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${
          order.orderDate || "N/A"
        }</td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-600 hover:underline">
         <a href="admin-pesanan-detail.html?id=${doc.id}">#${doc.id}</a>
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${
          order.products ? order.products.map((p) => p.name).join(", ") : "N/A"
        }</td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-600 hover:underline">
         <a href="pengguna-detail.html?id=${order.jastiperId}">${
                order.jastiperName || "N/A"
              }</a>
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatCurrency(
          order.totalAmount || 0
        )}</td>
       </tr>
      `;
              salesTableBody.innerHTML += row;
            });
          } catch (error) {
            console.error("Error fetching detailed sales data: ", error);
            document.getElementById(
              "sales-detail-table-body"
            ).innerHTML = `<tr><td colspan="5" class="text-center py-4 text-red-500">Error memuat data penjualan: ${error.message}</td></tr>`;
            alert("Error loading detailed sales data: " + error.message);
          }
        };

        // Fetch Data for Daily Sales Chart
        const fetchDailySalesData = async () => {
          try {
            // This data would typically come from an aggregation of orders or a dedicated sales metrics collection
            // For this example, let's simulate fetching aggregated daily sales
            const dailySalesDocs = await db
              .collection("dailySales")
              .where("date", ">=", "2025-07-01")
              .where("date", "<=", "2025-07-31")
              .orderBy("date", "asc")
              .get();

            const labels = [];
            const data = [];
            dailySalesDocs.forEach((doc) => {
              labels.push(
                new Date(doc.data().date).toLocaleDateString("id-ID", {
                  day: "numeric",
                  month: "short",
                })
              );
              data.push(doc.data().totalSales);
            });

            if (dailySalesChart) {
              dailySalesChart.data.labels = labels;
              dailySalesChart.data.datasets[0].data = data;
              dailySalesChart.update();
            }
          } catch (error) {
            console.error("Error fetching daily sales data for chart: ", error);
            // Optionally update chart to show error state
          }
        };

        // Fetch Data for Category Sales Chart
        const fetchCategorySalesData = async () => {
          try {
            // This data would typically come from an aggregation of product categories in orders
            // For this example, let's simulate fetching aggregated category sales
            const categorySalesDocs = await db
              .collection("categorySales")
              .where("month", "==", "July")
              .where("year", "==", 2025)
              .get();

            const labels = [];
            const data = [];
            const backgroundColors = []; // Store colors from Firebase if available or define them here

            if (!categorySalesDocs.empty) {
              categorySalesDocs.forEach((doc) => {
                labels.push(doc.data().categoryName);
                data.push(doc.data().totalSalesPercentage); // Or totalSales and calculate percentage in JS
                backgroundColors.push(doc.data().color || getRandomColor()); // Assume color field or generate
              });
            } else {
              // Fallback or empty state if no data
              labels.push("Tidak ada data");
              data.push(100);
              backgroundColors.push("rgb(200, 200, 200)");
            }

            if (categorySalesChart) {
              categorySalesChart.data.labels = labels;
              categorySalesChart.data.datasets[0].data = data;
              categorySalesChart.data.datasets[0].backgroundColor =
                backgroundColors;
              categorySalesChart.update();
            }
          } catch (error) {
            console.error(
              "Error fetching category sales data for chart: ",
              error
            );
            // Optionally update chart to show error state
          }
        };

        // Helper to get a random color if not provided by Firebase
        function getRandomColor() {
          var letters = "0123456789ABCDEF";
          var color = "#";
          for (var i = 0; i < 6; i++) {
            color += letters[Math.floor(Math.random() * 16)];
          }
          return color;
        }

        // Initialize Charts (empty data initially, will be populated by Firebase fetches)
        var dailySalesChart = new Chart(
          document.getElementById("dailySalesChart"),
          {
            type: "line",
            data: {
              labels: [],
              datasets: [
                {
                  label: "Penjualan (Rp)",
                  data: [],
                  borderColor: "rgb(75, 192, 192)",
                  tension: 0.1,
                  fill: false,
                },
              ],
            },
            options: {
              responsive: true,
              plugins: {
                legend: { display: true, position: "top" },
                title: { display: false },
              },
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    callback: function (value, index, values) {
                      if (parseInt(value) >= 1000000) {
                        return (
                          "Rp " +
                          (value / 1000000).toLocaleString("id-ID") +
                          " Jt"
                        );
                      }
                      if (parseInt(value) >= 1000) {
                        return (
                          "Rp " + (value / 1000).toLocaleString("id-ID") + " Rb"
                        );
                      }
                      return "Rp " + value.toLocaleString("id-ID");
                    },
                  },
                },
              },
            },
          }
        );

        var categorySalesChart = new Chart(
          document.getElementById("categorySalesChart"),
          {
            type: "pie",
            data: {
              labels: [],
              datasets: [
                {
                  label: "Penjualan (%)",
                  data: [],
                  backgroundColor: [],
                  hoverOffset: 4,
                },
              ],
            },
            options: {
              responsive: true,
              plugins: {
                legend: { position: "top" },
                title: { display: false },
              },
            },
          }
        );

        // Call the functions to fetch data
        fetchReportInfo();
        fetchSummaryPerformance();
        fetchDetailedSales();
        fetchDailySalesData();
        fetchCategorySalesData();
      });
    </script>
  </body>
</html>
